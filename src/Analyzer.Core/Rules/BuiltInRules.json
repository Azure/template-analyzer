[
  {
    "name": "AppServiceApiApp_HTTPS",
    "description": "API App should only be accessible over HTTPS",
    "recommendation": "Use HTTPS to ensure server/service authentication and protect data in transit from network layer eavesdropping attacks",
    "helpUri": "https://github.com/Azure/template-analyzer/docs/built-in-bpa-rules.md/#api-app-should-only-be-accessible-over-https",
    "evaluation": {
      "resourceType": "Microsoft.Web/sites",
      "where": {
        "path": "kind",
        "regex": "api$"
      },
      "allOf": [
        {
          "path": "properties.httpsOnly",
          "equals": true
        }
      ]
    }
  },
  {
    "name": "AppServiceFunctionApp_HTTPS",
    "description": "Function App should only be accessible over HTTPS",
    "recommendation": "Use HTTPS to ensure server/service authentication and protect data in transit from network layer eavesdropping attacks",
    "helpUri": "https://github.com/Azure/template-analyzer/docs/built-in-bpa-rules.md/#function-app-should-only-be-accessible-over-https",
    "evaluation": {
      "resourceType": "Microsoft.Web/sites",
      "where": {
        "path": "kind",
        "regex": "^functionapp"
      },
      "allOf": [
        {
          "path": "properties.httpsOnly",
          "equals": true
        }
      ]
    }
  },
  {
    "name": "AppServiceWebApp_HTTPS",
    "description": "Web Application should only be accessible over HTTPS",
    "recommendation": "Use HTTPS to ensure server/service authentication and protect data in transit from network layer eavesdropping attacks",
    "helpUri": "https://github.com/Azure/template-analyzer/docs/built-in-bpa-rules.md/#web-application-should-only-be-accessible-over-https",
    "evaluation": {
      "resourceType": "Microsoft.Web/sites",
      "where": {
        "anyOf": [
          {
            "path": "kind",
            "exists": false
          },
          {
            "path": "kind",
            "regex": "^app"
          }
        ]
      },
      "allOf": [
        {
          "path": "properties.httpsOnly",
          "equals": true
        }
      ]
    }
  },
  {
    "name": "Authorization_RoleDefinition_No_Custom_RBAC",
    "description": "Use built-in roles instead of custom RBAC roles",
    "recommendation": "Use built-in roles such as 'Owner, Contributer, Reader' instead of custom RBAC roles",
    "helpUri": "https://github.com/Azure/template-analyzer/docs/built-in-bpa-rules.md/#use-built-in-roles-instead-of-custom-rbac-roles",
    "evaluation": {
      "resourceType": "Microsoft.Authorization/roleDefinitions",
      "path": "properties.type",
      "notEquals": "CustomRole"
    }
  },
  {
    "name": "AutomationAccounts_Variables_Encrypted",
    "description": "Automation account variables should be encrypted",
    "recommendation": "Enable encryption of Automation account variable assets when storing sensitive data",
    "helpUri": "https://github.com/Azure/template-analyzer/docs/built-in-bpa-rules.md/#automation-account-variables-should-be-encrypted",
    "evaluation": {
      "resourceType": "Microsoft.Automation/automationAccounts/variables",
      "path": "properties.isEncrypted",
      "equals": true
    }
  },
  {
    "name": "Cache_Redis_SSL_Only",
    "description": "Only secure connections to your Azure Cache for Redis should be enabled",
    "recommendation": "Enable connections via SSL only to Redis Cache",
    "helpUri": "https://github.com/Azure/template-analyzer/docs/built-in-bpa-rules.md/#only-secure-connections-to-your-azure-cache-for-redis-should-be-enabled",
    "evaluation": {
      "resourceType": "Microsoft.Cache/redis",
      "path": "properties.enableNonSslPort",
      "notEquals": true
    }
  },
  {
    "name": "Compute_VirtualMachine_ShouldNotBePreview",
    "description": "Ensure all virtual machines are not using preview images",
    "recommendation": "Use a non-preview image for virtual machines",
    "helpUri": "https://github.com/Azure/template-analyzer/docs/built-in-bpa-rules.md/#ensure-all-virtual-machines-are-not-using-preview-images",
    "evaluation": {
      "resourceType": "Microsoft.Compute/virtualMachines",
      "anyOf": [
        {
          "path": "properties.storageProfile.imageReference",
          "regex": "^((?!-preview$).)*$"
        },
        {
          "path": "properties.storageProfile.imageReference.version",
          "regex": "^((?!-preview$).)*$"
        }
      ]
    }
  },
  {
    "name": "Compute_VirtualMachineScaleSets_ShouldNotBePreview",
    "description": "Ensure all virtual machine scale set instances are not using preview images",
    "recommendation": "Use a non-preview image for virtual machine scale set instances",
    "helpUri": "https://github.com/Azure/template-analyzer/docs/built-in-bpa-rules.md/#ensure-all-virtual-machine-scale-set-instances-are-not-using-preview-images",
    "evaluation": {
      "resourceType": "Microsoft.Compute/virtualMachineScaleSets",
      "anyOf": [
        {
          "path": "properties.virtualMachineProfile.storageProfile.imageReference",
          "regex": "^((?!-preview$).)*$"
        },
        {
          "path": "properties.virtualMachineProfile.storageProfile.imageReference.version",
          "regex": "^((?!-preview$).)*$"
        }
      ]
    }
  },
  {
    "name": "Kubernetes_Must_Restrict_Network_Access",
    "description": "Authorized IP ranges should be defined on Kubernetes Services",
    "recommendation": "Restrict access to the Kubernetes Service Management API by granting API access only to IP addresses in specific ranges",
    "helpUri": "https://github.com/Azure/template-analyzer/docs/built-in-bpa-rules.md/#authorized-ip-ranges-should-be-defined-on-kubernetes-services",
    "evaluation": {
      "resourceType": "Microsoft.ContainerService/managedClusters",
      "anyOf": [
        {
          "path": "properties.apiServerAccessProfile.authorizedIPRanges",
          "exists": true
        },
        {
          "path": "properties.apiServerAccessProfile.enablePrivateCluster",
          "equals": true
        }
      ]
    }
  },
  {
    "name": "Kubernetes_Must_Use_RBAC",
    "description": "Role-Based Access Control (RBAC) should be used on Kubernetes Services",
    "recommendation": "Enable RBAC in Kubernetes clusters",
    "helpUri": "https://github.com/Azure/template-analyzer/docs/built-in-bpa-rules.md/#role-based-access-control-rbac-should-be-used-on-kubernetes-services",
    "evaluation": {
      "resourceType": "Microsoft.ContainerService/managedClusters",
      "allOf": [
        {
          "path": "properties.enableRBAC",
          "hasValue": true
        },
        {
          "path": "properties.enableRBAC",
          "equals": true
        }
      ]
    }
  },
  {
    "name": "ServiceFabric_Client_AAD_Auth_Only",
    "description": "Service Fabric clusters should only use Azure Active Directory for client authentication",
    "recommendation": "Enable AAD client authentication on your Service Fabric clusters",
    "helpUri": "https://github.com/Azure/template-analyzer/docs/built-in-bpa-rules.md/#service-fabric-clusters-should-only-use-azure-active-directory-for-client-authentication",
    "evaluation": {
      "resourceType": "Microsoft.ServiceFabric/clusters",
      "path": "properties.azureActiveDirectory.tenantId",
      "hasValue": true
    }
  }
]