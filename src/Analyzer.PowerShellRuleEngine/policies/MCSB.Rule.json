[{
// Synopsis: To ensure secure configurations of in-guest settings of your machine, install the Guest Configuration extension. In-guest settings that the extension monitors include the configuration of the operating system, application configuration or presence, and environment settings. Once installed, in-guest policies will be available such as 'Windows Exploit guard should be enabled'. Learn more at https://aka.ms/gcpol.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.9ab0697c0b82","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/ae89ebca-1c92-4898-ac2c-9f63decb045c","Azure.Policy/version":"1.0.2"}},"spec":{"type":["Microsoft.Compute/virtualMachines"],"where":{"allOf":[{"equals":"Microsoft.Compute/virtualMachines","type":"."},{"anyOf":[{"field":"properties.storageProfile.imageReference.publisher","in":["esri","incredibuild","MicrosoftDynamicsAX","MicrosoftSharepoint","MicrosoftVisualStudio","MicrosoftWindowsDesktop","MicrosoftWindowsServerHPCPack","microsoft-aks","qubole-inc","datastax","couchbase","scalegrid","checkpoint","paloaltonetworks","debian"]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"MicrosoftWindowsServer"},{"field":"properties.storageProfile.imageReference.sku","notLike":"2008*"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"MicrosoftSQLServer"},{"field":"properties.storageProfile.imageReference.offer","notLike":"SQL2008*"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"microsoft-dsvm"},{"field":"properties.storageProfile.imageReference.offer","equals":"dsvm-windows"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"microsoft-ads"},{"field":"properties.storageProfile.imageReference.offer","in":["standard-data-science-vm","windows-data-science-vm"]}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"batch"},{"field":"properties.storageProfile.imageReference.offer","equals":"rendering-windows2016"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"center-for-internet-security-inc"},{"field":"properties.storageProfile.imageReference.offer","like":"cis-windows-server-201*"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"pivotal"},{"field":"properties.storageProfile.imageReference.offer","like":"bosh-windows-server*"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"cloud-infrastructure-services"},{"field":"properties.storageProfile.imageReference.offer","like":"ad*"}]},{"allOf":[{"anyOf":[{"field":"properties.osProfile.windowsConfiguration","exists":true},{"field":"properties.storageProfile.osDisk.osType","like":"Windows*"}]},{"anyOf":[{"field":"properties.storageProfile.imageReference.sku","exists":false},{"allOf":[{"field":"properties.storageProfile.imageReference.sku","notLike":"2008*"},{"field":"properties.storageProfile.imageReference.offer","notLike":"SQL2008*"}]}]}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"OpenLogic"},{"field":"properties.storageProfile.imageReference.offer","like":"CentOS*"},{"field":"properties.storageProfile.imageReference.sku","notLike":"6*"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"Oracle"},{"field":"properties.storageProfile.imageReference.offer","equals":"Oracle-Linux"},{"field":"properties.storageProfile.imageReference.sku","notLike":"6*"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"RedHat"},{"field":"properties.storageProfile.imageReference.offer","in":["RHEL","RHEL-HA","RHEL-SAP","RHEL-SAP-APPS","RHEL-SAP-HA","RHEL-SAP-HANA"]},{"field":"properties.storageProfile.imageReference.sku","notLike":"6*"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"RedHat"},{"field":"properties.storageProfile.imageReference.offer","in":["osa","rhel-byos"]}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"center-for-internet-security-inc"},{"field":"properties.storageProfile.imageReference.offer","in":["cis-centos-7-l1","cis-centos-7-v2-1-1-l1","cis-centos-8-l1","cis-debian-linux-8-l1","cis-debian-linux-9-l1","cis-nginx-centos-7-v1-1-0-l1","cis-oracle-linux-7-v2-0-0-l1","cis-oracle-linux-8-l1","cis-postgresql-11-centos-linux-7-level-1","cis-rhel-7-l2","cis-rhel-7-v2-2-0-l1","cis-rhel-8-l1","cis-suse-linux-12-v2-0-0-l1","cis-ubuntu-linux-1604-v1-0-0-l1","cis-ubuntu-linux-1804-l1"]}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"credativ"},{"field":"properties.storageProfile.imageReference.offer","equals":"Debian"},{"field":"properties.storageProfile.imageReference.sku","notLike":"7*"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"Suse"},{"field":"properties.storageProfile.imageReference.offer","like":"SLES*"},{"field":"properties.storageProfile.imageReference.sku","notLike":"11*"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"Canonical"},{"field":"properties.storageProfile.imageReference.offer","equals":"UbuntuServer"},{"field":"properties.storageProfile.imageReference.sku","notLike":"12*"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"microsoft-dsvm"},{"field":"properties.storageProfile.imageReference.offer","in":["linux-data-science-vm-ubuntu","azureml"]}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"cloudera"},{"field":"properties.storageProfile.imageReference.offer","equals":"cloudera-centos-os"},{"field":"properties.storageProfile.imageReference.sku","notLike":"6*"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"cloudera"},{"field":"properties.storageProfile.imageReference.offer","equals":"cloudera-altus-centos-os"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"microsoft-ads"},{"field":"properties.storageProfile.imageReference.offer","like":"linux*"}]},{"allOf":[{"anyOf":[{"field":"properties.osProfile.linuxConfiguration","exists":true},{"field":"properties.storageProfile.osDisk.osType","like":"Linux*"}]},{"anyOf":[{"field":"properties.storageProfile.imageReference.publisher","exists":false},{"field":"properties.storageProfile.imageReference.publisher","notIn":["OpenLogic","RedHat","credativ","Suse","Canonical","microsoft-dsvm","cloudera","microsoft-ads","center-for-internet-security-inc","Oracle","AzureDatabricks"]}]}]}]}]},"condition":{"field":"resources","allOf":[{"allOf":[{"field":"properties.publisher","equals":"Microsoft.GuestConfiguration"},{"field":"properties.provisioningState","equals":"Succeeded"}]}],"where":{"type":".","equals":"Microsoft.Compute/virtualMachines/extensions"}}}},{
// Synopsis: Audit enabling of resource logs. This enables you to recreate activity trails to use for investigation purposes; when a security incident occurs or when your network is compromised
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.c397c7e52a57","tags":{"Azure.Policy/category":"Internet of Things"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/383856f8-de7f-44a2-81fc-e5135b5c2aa4","Azure.Policy/version":"3.0.1"}},"spec":{"type":["Microsoft.Devices/IotHubs"],"where":{"equals":"Microsoft.Devices/IotHubs","type":"."},"condition":{"field":"resources","allOf":[{"greaterOrEquals":1,"field":"properties.logs[? || (@.retentionPolicy.enabled == 'true' && (@.retentionPolicy.days == '0' || @.retentionPolicy.days >= '365') && @.enabled == 'true') || (@.enabled == 'true')]"}],"where":{"type":".","equals":"Microsoft.Insights/diagnosticSettings"}}}},{
// Synopsis: It is recommended to enable Logs so that activity trail can be recreated when investigations are required in the event of an incident or a compromise.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.a51aba1a3cb4","tags":{"Azure.Policy/category":"Compute"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/7c1b1214-f927-48bf-8882-84f0af6588b1","Azure.Policy/version":"2.1.0"}},"spec":{"type":["Microsoft.Compute/virtualMachineScaleSets"],"where":{"anyOf":[{"allOf":[{"equals":"Microsoft.Compute/virtualMachineScaleSets","type":"."},{"value":false,"equals":true}]},{"allOf":[{"equals":"Microsoft.Compute/virtualMachineScaleSets","type":"."},{"value":false,"equals":false},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.publisher","notEquals":"microsoft-aks"},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.offer","notEquals":"aks"},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.sku","notLike":"aks*"}]}]},"condition":{"field":"resources","allOf":[{"anyOf":[{"field":"properties.publisher","equals":"Microsoft.AKS"},{"allOf":[{"field":"properties.type","equals":"IaaSDiagnostics"},{"field":"properties.publisher","equals":"Microsoft.Azure.Diagnostics"}]},{"allOf":[{"field":"properties.type","equals":"LinuxDiagnostic"},{"field":"properties.publisher","in":["Microsoft.OSTCExtensions","Microsoft.Azure.Diagnostics"]}]}]}],"where":{"type":".","equals":"Microsoft.Compute/virtualMachineScaleSets/extensions"}}}},{
// Synopsis: Network access to storage accounts should be restricted. Configure network rules so only applications from allowed networks can access the storage account. To allow connections from specific internet or on-premises clients, access can be granted to traffic from specific Azure virtual networks or to public internet IP address ranges
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.41ba16ba2225","tags":{"Azure.Policy/category":"Storage"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/34c877ad-507e-4c82-993e-3452a6e0ad3c","Azure.Policy/version":"1.1.1"}},"spec":{"type":["Microsoft.Storage/storageAccounts"],"condition":{"allOf":[{"equals":"Microsoft.Storage/storageAccounts","type":"."},{"field":"properties.networkAcls.defaultAction","notEquals":"Deny"}]}}},{
// Synopsis: Audit built-in roles such as 'Owner, Contributer, Reader' instead of custom RBAC roles, which are error prone. Using custom roles is treated as an exception and requires a rigorous review and threat modeling
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.583e6b5699e7","tags":{"Azure.Policy/category":"General"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/a451c1ef-c6ca-483d-87ed-f49761e3ffb5","Azure.Policy/version":"1.0.0"}},"spec":{"type":["Microsoft.Authorization/roleDefinitions"],"condition":{"allOf":[{"equals":"Microsoft.Authorization/roleDefinitions","type":"."},{"field":"properties.type","equals":"CustomRole"}]}}},{
// Synopsis: Audit requirement of Secure transfer in your storage account. Secure transfer is an option that forces your storage account to accept requests only from secure connections (HTTPS). Use of HTTPS ensures authentication between the server and the service and protects data in transit from network layer attacks such as man-in-the-middle, eavesdropping, and session-hijacking
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.8e885c3b82e2","tags":{"Azure.Policy/category":"Storage"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/404c3081-a854-4457-ae30-26a93ef643f9","Azure.Policy/version":"2.0.0"}},"spec":{"type":["Microsoft.Storage/storageAccounts"],"condition":{"allOf":[{"equals":"Microsoft.Storage/storageAccounts","type":"."},{"anyOf":[{"allOf":[{"less":"2019-04-01","field":"apiVersion"},{"field":"properties.supportsHttpsTrafficOnly","exists":false}]},{"field":"properties.supportsHttpsTrafficOnly","equals":"false"}]}]}}},{
// Synopsis: Service Fabric provides three levels of protection (None, Sign and EncryptAndSign) for node-to-node communication using a primary cluster certificate. Set the protection level to ensure that all node-to-node messages are encrypted and digitally signed
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.2e00adf999bc","tags":{"Azure.Policy/category":"Service Fabric"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/617c02be-7f02-4efd-8836-3180d47b6c68","Azure.Policy/version":"1.1.0"}},"spec":{"type":["Microsoft.ServiceFabric/clusters"],"condition":{"allOf":[{"equals":"Microsoft.ServiceFabric/clusters","type":"."},{"anyOf":[{"field":"properties.fabricSettings[*].name","notEquals":"Security"},{"field":"properties.fabricSettings[*].parameters[*].name","notEquals":"ClusterProtectionLevel"},{"field":"properties.fabricSettings[*].parameters[*].value","notEquals":"EncryptAndSign"}]}]}}},{
// Synopsis: Transparent data encryption should be enabled to protect data-at-rest and meet compliance requirements
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.8383d5706c2e","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/17k78e20-9358-41c9-923c-fb736d382a12","Azure.Policy/version":"2.0.0"}},"spec":{"type":["Microsoft.Sql/servers/databases"],"where":{"allOf":[{"equals":"Microsoft.Sql/servers/databases","type":"."},{"field":"name","notEquals":"master"}]},"condition":{"field":"resources","allOf":[{"anyOf":[{"field":"Microsoft.Sql/transparentDataEncryption.status","equals":"enabled"},{"field":"properties.state","equals":"enabled"}]}],"where":{"allOf":[{"type":".","equals":"Microsoft.Sql/servers/databases/transparentDataEncryption"},{"name":".","equals":"current"}]}}}},{
// Synopsis: Auditing on your SQL Server should be enabled to track database activities across all databases on the server and save them in an audit log.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.301d6dfcbe88","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/a6fb4358-5bf4-4ad7-ba82-2cd2f41ce5e9","Azure.Policy/version":"2.0.0"}},"spec":{"type":["Microsoft.Sql/servers"],"where":{"allOf":[{"equals":"Microsoft.Sql/servers","type":"."},{"field":"kind","notContains":"analytics"}]},"condition":{"field":"resources","allOf":[{"field":"Microsoft.Sql/auditingSettings.state","equals":"enabled"}],"where":{"allOf":[{"type":".","equals":"Microsoft.Sql/servers/auditingSettings"},{"name":".","equals":"default"}]}}}},{
// Synopsis: Remote debugging requires inbound ports to be opened on Function apps. Remote debugging should be turned off.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.5ded090736c5","tags":{"Azure.Policy/category":"App Service"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/0e60b895-3786-45da-8377-9c6b4b6ac5f9","Azure.Policy/version":"2.0.0"}},"spec":{"type":["Microsoft.Web/sites"],"where":{"allOf":[{"equals":"Microsoft.Web/sites","type":"."},{"field":"kind","contains":"functionapp"},{"field":"kind","notContains":"workflowapp"}]},"condition":{"field":"resources","allOf":[{"field":"properties.remoteDebuggingEnabled","equals":"false"}],"where":{"type":".","equals":"Microsoft.Web/sites/config"}}}},{
// Synopsis: Remote debugging requires inbound ports to be opened on an App Service app. Remote debugging should be turned off.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.a47983ae1916","tags":{"Azure.Policy/category":"App Service"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/cb510bfd-1cba-4d9f-a230-cb0976f4bb71","Azure.Policy/version":"2.0.0"}},"spec":{"type":["Microsoft.Web/sites"],"where":{"allOf":[{"equals":"Microsoft.Web/sites","type":"."},{"field":"kind","notContains":"functionapp"}]},"condition":{"field":"resources","allOf":[{"field":"properties.remoteDebuggingEnabled","equals":"false"}],"where":{"type":".","equals":"Microsoft.Web/sites/config"}}}},{
// Synopsis: Use of HTTPS ensures server/service authentication and protects data in transit from network layer eavesdropping attacks.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.20f0d605453a","tags":{"Azure.Policy/category":"App Service"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/6d555dd1-86f2-4f1c-8ed7-5abae7c6cbab","Azure.Policy/version":"5.0.0"}},"spec":{"type":["Microsoft.Web/sites"],"condition":{"allOf":[{"equals":"Microsoft.Web/sites","type":"."},{"field":"kind","contains":"functionapp"},{"field":"kind","notContains":"workflowapp"},{"anyOf":[{"field":"properties.httpsOnly","exists":false},{"field":"properties.httpsOnly","equals":"false"}]}]}}},{
// Synopsis: Use of HTTPS ensures server/service authentication and protects data in transit from network layer eavesdropping attacks.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.615423541d5e","tags":{"Azure.Policy/category":"App Service"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/a4af4a39-4135-47fb-b175-47fbdf85311d","Azure.Policy/version":"4.0.0"}},"spec":{"type":["Microsoft.Web/sites"],"condition":{"allOf":[{"equals":"Microsoft.Web/sites","type":"."},{"field":"kind","notContains":"functionapp"},{"anyOf":[{"field":"properties.httpsOnly","exists":false},{"field":"properties.httpsOnly","equals":"false"}]}]}}},{
// Synopsis: Cross-Origin Resource Sharing (CORS) should not allow all domains to access your Function app. Allow only required domains to interact with your Function app.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.6739391217cf","tags":{"Azure.Policy/category":"App Service"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/0820b7b9-23aa-4725-a1ce-ae4558f718e5","Azure.Policy/version":"2.0.0"}},"spec":{"type":["Microsoft.Web/sites"],"where":{"allOf":[{"equals":"Microsoft.Web/sites","type":"."},{"field":"kind","contains":"functionapp"},{"field":"kind","notContains":"workflowapp"}]},"condition":{"field":"resources","allOf":[{"field":"properties.cors.allowedOrigins[*]","notEquals":"*"}],"where":{"type":".","equals":"Microsoft.Web/sites/config"}}}},{
// Synopsis: Cross-Origin Resource Sharing (CORS) should not allow all domains to access your app. Allow only required domains to interact with your app.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.f124a0c4ad0a","tags":{"Azure.Policy/category":"App Service"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/5744710e-cc2f-4ee8-8809-3b11e89f4bc9","Azure.Policy/version":"2.0.0"}},"spec":{"type":["Microsoft.Web/sites"],"where":{"allOf":[{"equals":"Microsoft.Web/sites","type":"."},{"field":"kind","notContains":"functionapp"}]},"condition":{"field":"resources","allOf":[{"field":"properties.cors.allowedOrigins[*]","notEquals":"*"}],"where":{"type":".","equals":"Microsoft.Web/sites/config"}}}},{
// Synopsis: Audit SQL servers without Advanced Data Security
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.d46136c49ce4","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/abfb4388-5bf4-4ad7-ba82-2cd2f41ceae9","Azure.Policy/version":"2.0.1"}},"spec":{"type":["Microsoft.Sql/servers"],"where":{"allOf":[{"equals":"Microsoft.Sql/servers","type":"."},{"field":"kind","notContains":"analytics"}]},"condition":{"field":"resources","allOf":[{"field":"properties.state","equals":"Enabled"}],"where":{"allOf":[{"type":".","equals":"Microsoft.Sql/servers/securityAlertPolicies"},{"name":".","equals":"Default"}]}}}},{
// Synopsis: Audit each SQL Managed Instance without advanced data security.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.dd2522c79dc4","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/abfb7388-5bf4-4ad7-ba99-2cd2f41cebb9","Azure.Policy/version":"1.0.2"}},"spec":{"type":["Microsoft.Sql/managedInstances"],"where":{"equals":"Microsoft.Sql/managedInstances","type":"."},"condition":{"field":"resources","allOf":[{"field":"properties.state","equals":"Enabled"}],"where":{"allOf":[{"type":".","equals":"Microsoft.Sql/managedInstances/securityAlertPolicies"},{"name":".","equals":"Default"}]}}}},{
// Synopsis: Restrict access to the Kubernetes Service Management API by granting API access only to IP addresses in specific ranges. It is recommended to limit access to authorized IP ranges to ensure that only applications from allowed networks can access the cluster.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.dcc408d3e552","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/0e246bcf-5f6f-4f87-bc6f-775d4712c7ea","Azure.Policy/version":"2.0.1"}},"spec":{"type":["Microsoft.ContainerService/managedClusters"],"condition":{"allOf":[{"equals":"Microsoft.ContainerService/managedClusters","type":"."},{"field":"properties.apiServerAccessProfile.authorizedIPRanges","exists":false},{"anyOf":[{"field":"properties.apiServerAccessProfile.enablePrivateCluster","exists":false},{"field":"properties.apiServerAccessProfile.enablePrivateCluster","equals":"false"}]}]}}},{
// Synopsis: Audit Azure SQL servers which do not have recurring vulnerability assessment scans enabled. Vulnerability assessment can discover, track, and help you remediate potential database vulnerabilities.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.6a8bbb756b6f","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/ef2a8f2a-b3d9-49cd-a8a8-9a3aaaf647d9","Azure.Policy/version":"2.0.0"}},"spec":{"type":["Microsoft.Sql/servers"],"where":{"allOf":[{"equals":"Microsoft.Sql/servers","type":"."},{"field":"kind","notContains":"analytics"}]},"condition":{"field":"resources","allOf":[{"field":"properties.recurringScans.isEnabled","equals":"True"}],"where":{"allOf":[{"type":".","equals":"Microsoft.Sql/servers/vulnerabilityAssessments"},{"name":".","equals":"default"}]}}}},{
// Synopsis: Audit each SQL Managed Instance which doesn't have recurring vulnerability assessment scans enabled. Vulnerability assessment can discover, track, and help you remediate potential database vulnerabilities.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.262e294c47a7","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/1b7aa243-30e4-4c9e-bca8-d0d3022b634a","Azure.Policy/version":"1.0.1"}},"spec":{"type":["Microsoft.Sql/managedInstances"],"where":{"equals":"Microsoft.Sql/managedInstances","type":"."},"condition":{"field":"resources","allOf":[{"field":"properties.recurringScans.isEnabled","equals":"True"}],"where":{"allOf":[{"type":".","equals":"Microsoft.Sql/managedInstances/vulnerabilityAssessments"},{"name":".","equals":"default"}]}}}},{
// Synopsis: Implementing Transparent Data Encryption (TDE) with your own key provides increased transparency and control over the TDE Protector, increased security with an HSM-backed external service, and promotion of separation of duties. This recommendation applies to organizations with a related compliance requirement.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.71e161fad9ea","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/0a370ff3-6cab-4e85-8995-295fd854c5b8","Azure.Policy/version":"2.0.1"}},"spec":{"type":["Microsoft.Sql/servers","Microsoft.Sql/servers/encryptionProtector"],"condition":{"anyOf":[{"allOf":[{"equals":"Microsoft.Sql/servers","type":"."},{"value":null,"notContains":"/providers/Microsoft.Synapse/"},{"anyOf":[{"field":"properties.keyId","exists":false},{"field":"properties.keyId","equals":""}]}]},{"allOf":[{"equals":"Microsoft.Sql/servers/encryptionProtector","type":"."},{"value":null,"notContains":"/providers/Microsoft.Synapse/"},{"field":"properties.serverKeyType","notequals":"AzureKeyVault"}]}]}}},{
// Synopsis: Implementing Transparent Data Encryption (TDE) with your own key provides you with increased transparency and control over the TDE Protector, increased security with an HSM-backed external service, and promotion of separation of duties. This recommendation applies to organizations with a related compliance requirement.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.bea48ebb9805","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/ac01ad65-10e5-46df-bdd9-6b0cad13e1d2","Azure.Policy/version":"2.0.0"}},"spec":{"type":["Microsoft.Sql/managedInstances","Microsoft.Sql/managedInstances/encryptionProtector"],"condition":{"anyOf":[{"allOf":[{"equals":"Microsoft.Sql/managedInstances","type":"."},{"anyOf":[{"field":"properties.keyId","exists":false},{"field":"properties.keyId","equals":""}]}]},{"allOf":[{"equals":"Microsoft.Sql/managedInstances/encryptionProtector","type":"."},{"field":"properties.serverKeyType","notequals":"AzureKeyVault"}]}]}}},{
// Synopsis: Security Center uses the Microsoft Dependency agent to collect network traffic data from your Azure virtual machines to enable advanced network protection features such as traffic visualization on the network map, network hardening recommendations and specific network threats.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.b9582017b710","tags":{"Azure.Policy/category":"Monitoring"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/2f2ee1de-44aa-4762-b6bd-0893fc3f306d","Azure.Policy/version":"1.0.2-preview"}},"spec":{"type":["Microsoft.Compute/virtualMachines"],"where":{"allOf":[{"equals":"Microsoft.Compute/virtualMachines","type":"."},{"anyOf":[{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"MicrosoftWindowsServer"},{"field":"properties.storageProfile.imageReference.offer","equals":"WindowsServer"},{"field":"properties.storageProfile.imageReference.sku","in":["2008-R2-SP1","2008-R2-SP1-smalldisk","2012-Datacenter","2012-Datacenter-smalldisk","2012-R2-Datacenter","2012-R2-Datacenter-smalldisk","2016-Datacenter","2016-Datacenter-Server-Core","2016-Datacenter-Server-Core-smalldisk","2016-Datacenter-smalldisk","2016-Datacenter-with-Containers","2016-Datacenter-with-RDSH","2019-Datacenter","2019-Datacenter-Core","2019-Datacenter-Core-smalldisk","2019-Datacenter-Core-with-Containers","2019-Datacenter-Core-with-Containers-smalldisk","2019-Datacenter-smalldisk","2019-Datacenter-with-Containers","2019-Datacenter-with-Containers-smalldisk","2019-Datacenter-zhcn"]}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"MicrosoftWindowsServer"},{"field":"properties.storageProfile.imageReference.offer","equals":"WindowsServerSemiAnnual"},{"field":"properties.storageProfile.imageReference.sku","in":["Datacenter-Core-1709-smalldisk","Datacenter-Core-1709-with-Containers-smalldisk","Datacenter-Core-1803-with-Containers-smalldisk"]}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"MicrosoftWindowsServerHPCPack"},{"field":"properties.storageProfile.imageReference.offer","equals":"WindowsServerHPCPack"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"MicrosoftSQLServer"},{"anyOf":[{"field":"properties.storageProfile.imageReference.offer","like":"*-WS2016"},{"field":"properties.storageProfile.imageReference.offer","like":"*-WS2016-BYOL"},{"field":"properties.storageProfile.imageReference.offer","like":"*-WS2012R2"},{"field":"properties.storageProfile.imageReference.offer","like":"*-WS2012R2-BYOL"}]}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"MicrosoftRServer"},{"field":"properties.storageProfile.imageReference.offer","equals":"MLServer-WS2016"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"MicrosoftVisualStudio"},{"field":"properties.storageProfile.imageReference.offer","in":["VisualStudio","Windows"]}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"MicrosoftDynamicsAX"},{"field":"properties.storageProfile.imageReference.offer","equals":"Dynamics"},{"field":"properties.storageProfile.imageReference.sku","equals":"Pre-Req-AX7-Onebox-U8"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"microsoft-ads"},{"field":"properties.storageProfile.imageReference.offer","equals":"windows-data-science-vm"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"MicrosoftWindowsDesktop"},{"field":"properties.storageProfile.imageReference.offer","equals":"Windows-10"}]}]}]},"condition":{"field":"resources","allOf":[{"allOf":[{"field":"properties.type","equals":"DependencyAgentWindows"},{"field":"properties.publisher","equals":"Microsoft.Azure.Monitoring.DependencyAgent"},{"field":"properties.provisioningState","equals":"Succeeded"}]}],"where":{"type":".","equals":"Microsoft.Compute/virtualMachines/extensions"}}}},{
// Synopsis: Security Center uses the Microsoft Dependency agent to collect network traffic data from your Azure virtual machines to enable advanced network protection features such as traffic visualization on the network map, network hardening recommendations and specific network threats.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.913c4dc56595","tags":{"Azure.Policy/category":"Monitoring"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/04c4380f-3fae-46e8-96c9-30193528f602","Azure.Policy/version":"1.0.2-preview"}},"spec":{"type":["Microsoft.Compute/virtualMachines"],"where":{"allOf":[{"equals":"Microsoft.Compute/virtualMachines","type":"."},{"anyOf":[{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"Canonical"},{"field":"properties.storageProfile.imageReference.offer","equals":"UbuntuServer"},{"anyOf":[{"field":"properties.storageProfile.imageReference.sku","in":["14.04.0-LTS","14.04.1-LTS","14.04.5-LTS"]},{"field":"properties.storageProfile.imageReference.sku","in":["16.04-LTS","16.04.0-LTS"]},{"field":"properties.storageProfile.imageReference.sku","in":["18.04-LTS"]}]}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"RedHat"},{"field":"properties.storageProfile.imageReference.offer","in":["RHEL","RHEL-SAP-HANA"]},{"anyOf":[{"field":"properties.storageProfile.imageReference.sku","like":"6.*"},{"field":"properties.storageProfile.imageReference.sku","like":"7*"}]}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"SUSE"},{"field":"properties.storageProfile.imageReference.offer","in":["SLES","SLES-HPC","SLES-HPC-Priority","SLES-SAP","SLES-SAP-BYOS","SLES-Priority","SLES-BYOS","SLES-SAPCAL","SLES-Standard"]},{"anyOf":[{"field":"properties.storageProfile.imageReference.sku","in":["12-SP2","12-SP3","12-SP4"]}]}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"OpenLogic"},{"field":"properties.storageProfile.imageReference.offer","in":["CentOS","Centos-LVM","CentOS-SRIOV"]},{"anyOf":[{"field":"properties.storageProfile.imageReference.sku","like":"6.*"},{"field":"properties.storageProfile.imageReference.sku","like":"7*"}]}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"cloudera"},{"field":"properties.storageProfile.imageReference.offer","equals":"cloudera-centos-os"},{"field":"properties.storageProfile.imageReference.sku","like":"7*"}]}]}]},"condition":{"field":"resources","allOf":[{"allOf":[{"field":"properties.type","equals":"DependencyAgentLinux"},{"field":"properties.publisher","equals":"Microsoft.Azure.Monitoring.DependencyAgent"},{"field":"properties.provisioningState","equals":"Succeeded"}]}],"where":{"type":".","equals":"Microsoft.Compute/virtualMachines/extensions"}}}},{
// Synopsis: This policy audits Windows Azure Arc machines if the Log Analytics extension is not installed.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.ce92f9c8f463","tags":{"Azure.Policy/category":"Monitoring"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/d69b1763-b96d-40b8-a2d9-ca31e9fd0d3e","Azure.Policy/version":"1.0.1-preview"}},"spec":{"type":["Microsoft.HybridCompute/machines"],"where":{"allOf":[{"equals":"Microsoft.HybridCompute/machines","type":"."},{"field":"properties.osName","like":"windows*"}]},"condition":{"field":"resources","allOf":[{"allOf":[{"field":"properties.type","equals":"MicrosoftMonitoringAgent"},{"field":"properties.publisher","equals":"Microsoft.EnterpriseCloud.Monitoring"},{"field":"properties.provisioningState","equals":"Succeeded"}]}],"where":{"type":".","equals":"Microsoft.HybridCompute/machines/extensions"}}}},{
// Synopsis: This policy audits Linux Azure Arc machines if the Log Analytics extension is not installed.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.c0ccfbace385","tags":{"Azure.Policy/category":"Monitoring"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/842c54e8-c2f9-4d79-ae8d-38d8b8019373","Azure.Policy/version":"1.0.1-preview"}},"spec":{"type":["Microsoft.HybridCompute/machines"],"where":{"allOf":[{"equals":"Microsoft.HybridCompute/machines","type":"."},{"field":"properties.osName","like":"linux*"}]},"condition":{"field":"resources","allOf":[{"allOf":[{"field":"properties.type","equals":"OmsAgentForLinux"},{"field":"properties.publisher","equals":"Microsoft.EnterpriseCloud.Monitoring"},{"field":"properties.provisioningState","equals":"Succeeded"}]}],"where":{"type":".","equals":"Microsoft.HybridCompute/machines/extensions"}}}},{
// Synopsis: Azure Defender for Key Vault provides an additional layer of protection and security intelligence by detecting unusual and potentially harmful attempts to access or exploit key vault accounts.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.92d6756b2760","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/0e6763cc-5078-4e64-889d-ff4d9a839047","Azure.Policy/version":"1.0.3"}},"spec":{"type":["Microsoft.Resources/subscriptions"],"where":{"equals":"Microsoft.Resources/subscriptions","type":"."},"condition":{"field":"resources","allOf":[{"field":"properties.pricingTier","equals":"Standard"}],"where":{"allOf":[{"type":".","equals":"Microsoft.Security/pricings"},{"name":".","equals":"KeyVaults"}]}}}},{
// Synopsis: Azure Defender for SQL provides functionality for surfacing and mitigating potential database vulnerabilities, detecting anomalous activities that could indicate threats to SQL databases, and discovering and classifying sensitive data.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.8edbf6f218de","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/7fe3b40f-802b-4cdd-8bd4-fd799c948cc2","Azure.Policy/version":"1.0.2"}},"spec":{"type":["Microsoft.Resources/subscriptions"],"where":{"equals":"Microsoft.Resources/subscriptions","type":"."},"condition":{"field":"resources","allOf":[{"field":"properties.pricingTier","equals":"Standard"}],"where":{"allOf":[{"type":".","equals":"Microsoft.Security/pricings"},{"name":".","equals":"SqlServers"}]}}}},{
// Synopsis: Azure Defender for SQL provides functionality for surfacing and mitigating potential database vulnerabilities, detecting anomalous activities that could indicate threats to SQL databases, and discovering and classifying sensitive data.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.411a210ff9f6","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/6581d072-105e-4418-827f-bd446d56421b","Azure.Policy/version":"1.0.2"}},"spec":{"type":["Microsoft.Resources/subscriptions"],"where":{"equals":"Microsoft.Resources/subscriptions","type":"."},"condition":{"field":"resources","allOf":[{"field":"properties.pricingTier","equals":"Standard"}],"where":{"allOf":[{"type":".","equals":"Microsoft.Security/pricings"},{"name":".","equals":"SqlServerVirtualMachines"}]}}}},{
// Synopsis: Azure Defender for Storage provides detections of unusual and potentially harmful attempts to access or exploit storage accounts.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.445fb0735747","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/308fbb08-4ab8-4e67-9b29-592e93fb94fa","Azure.Policy/version":"1.0.3"}},"spec":{"type":["Microsoft.Resources/subscriptions"],"where":{"equals":"Microsoft.Resources/subscriptions","type":"."},"condition":{"field":"resources","allOf":[{"field":"properties.pricingTier","equals":"Standard"}],"where":{"allOf":[{"type":".","equals":"Microsoft.Security/pricings"},{"name":".","equals":"StorageAccounts"}]}}}},{
// Synopsis: Azure Defender for App Service leverages the scale of the cloud, and the visibility that Azure has as a cloud provider, to monitor for common web app attacks.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.d5e61d13c095","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/2913021d-f2fd-4f3d-b958-22354e2bdbcb","Azure.Policy/version":"1.0.3"}},"spec":{"type":["Microsoft.Resources/subscriptions"],"where":{"equals":"Microsoft.Resources/subscriptions","type":"."},"condition":{"field":"resources","allOf":[{"field":"properties.pricingTier","equals":"Standard"}],"where":{"allOf":[{"type":".","equals":"Microsoft.Security/pricings"},{"name":".","equals":"AppServices"}]}}}},{
// Synopsis: Microsoft Defender for Containers provides hardening, vulnerability assessment and run-time protections for your Azure, hybrid, and multi-cloud Kubernetes environments.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.1262db9898ef","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/1c988dd6-ade4-430f-a608-2a3e5b0a6d38","Azure.Policy/version":"1.0.0"}},"spec":{"type":["Microsoft.Resources/subscriptions"],"where":{"equals":"Microsoft.Resources/subscriptions","type":"."},"condition":{"field":"resources","allOf":[{"field":"properties.pricingTier","equals":"Standard"}],"where":{"allOf":[{"type":".","equals":"Microsoft.Security/pricings"},{"name":".","equals":"Containers"}]}}}},{
// Synopsis: Azure Defender for servers provides real-time threat protection for server workloads and generates hardening recommendations as well as alerts about suspicious activities.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.0546549fc12d","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/4da35fc9-c9e7-4960-aec9-797fe7d9051d","Azure.Policy/version":"1.0.3"}},"spec":{"type":["Microsoft.Resources/subscriptions"],"where":{"equals":"Microsoft.Resources/subscriptions","type":"."},"condition":{"field":"resources","allOf":[{"field":"properties.pricingTier","equals":"Standard"}],"where":{"allOf":[{"type":".","equals":"Microsoft.Security/pricings"},{"name":".","equals":"VirtualMachines"}]}}}},{
// Synopsis: The Azure Policy extension for Azure Arc provides at-scale enforcements and safeguards on your Arc enabled Kubernetes clusters in a centralized, consistent manner. Learn more at https://aka.ms/akspolicydoc.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.8f250288e9da","tags":{"Azure.Policy/category":"Kubernetes"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/6b2122c1-8120-4ff5-801b-17625a355590","Azure.Policy/version":"1.0.0-preview"}},"spec":{"type":["Microsoft.Kubernetes/connectedClusters"],"where":{"equals":"Microsoft.Kubernetes/connectedClusters","type":"."},"condition":{"field":"resources","allOf":[{"field":"properties.extensionType","equals":"microsoft.policyinsights"}],"where":{"type":".","equals":"Microsoft.KubernetesConfiguration/extensions"}}}},{
// Synopsis: Microsoft Defender for Cloud extension for Azure Arc provides threat protection for your Arc enabled Kubernetes clusters. The extension collects data from all nodes in the cluster and sends it to the Azure Defender for Kubernetes backend in the cloud for further analysis. Learn more in https://docs.microsoft.com/azure/defender-for-cloud/defender-for-containers-enable?pivots=defender-for-container-arc.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.086a35280db9","tags":{"Azure.Policy/category":"Kubernetes"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/8dfab9c4-fe7b-49ad-85e4-1e9be085358f","Azure.Policy/version":"6.0.0-preview"}},"spec":{"type":["Microsoft.Kubernetes/connectedClusters"],"where":{"allOf":[{"equals":"Microsoft.Kubernetes/connectedClusters","type":"."},{"field":"properties.distribution","notIn":["aks","aks_management","eks","gke"]}]},"condition":{"field":"resources","allOf":[{"allOf":[{"field":"properties.extensionType","equals":"microsoft.azuredefender.kubernetes"},{"field":"properties.provisioningState","equals":"Succeeded"}]}],"where":{"type":".","equals":"Microsoft.KubernetesConfiguration/extensions"}}}},{
// Synopsis: Microsoft Defender for Containers provides cloud-native Kubernetes security capabilities including environment hardening, workload protection, and run-time protection. When you enable the SecurityProfile.AzureDefender on your Azure Kubernetes Service cluster, an agent is deployed to your cluster to collect security event data. Learn more about Microsoft Defender for Containers in https://docs.microsoft.com/azure/defender-for-cloud/defender-for-containers-introduction?tabs=defender-for-container-arch-aks
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.b54880f4f923","tags":{"Azure.Policy/category":"Kubernetes"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/a1840de2-8088-4ea8-b153-b4c723e9cb01","Azure.Policy/version":"2.0.0"}},"spec":{"type":["Microsoft.ContainerService/managedClusters"],"condition":{"allOf":[{"equals":"Microsoft.ContainerService/managedClusters","type":"."},{"field":"properties.securityProfile.defender.securityMonitoring.enabled","notEquals":true}]}}},{
// Synopsis: Use a managed identity for enhanced authentication security
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.4648c6aff5cd","tags":{"Azure.Policy/category":"App Service"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/0da106f2-4ca3-48e8-bc85-c638fe6aea8f","Azure.Policy/version":"3.0.0"}},"spec":{"type":["Microsoft.Web/sites"],"where":{"allOf":[{"equals":"Microsoft.Web/sites","type":"."},{"field":"kind","contains":"functionapp"},{"field":"kind","notContains":"workflowapp"}]},"condition":{"field":"resources","allOf":[{"anyOf":[{"field":"properties.managedServiceIdentityId","exists":true},{"field":"properties.xManagedServiceIdentityId","exists":true}]}],"where":{"allOf":[{"type":".","equals":"Microsoft.Web/sites/config"},{"name":".","equals":"web"}]}}}},{
// Synopsis: Azure Database for MariaDB allows you to choose the redundancy option for your database server. It can be set to a geo-redundant backup storage in which the data is not only stored within the region in which your server is hosted, but is also replicated to a paired region to provide recovery option in case of a region failure. Configuring geo-redundant storage for backup is only allowed during server create.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.617ef7936379","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/0ec47710-77ff-4a3d-9181-6aa50af424d0","Azure.Policy/version":"1.0.1"}},"spec":{"type":["Microsoft.DBforMariaDB/servers"],"condition":{"allOf":[{"equals":"Microsoft.DBforMariaDB/servers","type":"."},{"field":"properties.storageProfile.geoRedundantBackup","notEquals":"Enabled"}]}}},{
// Synopsis: Use a managed identity for enhanced authentication security
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.17e6c52a0ae7","tags":{"Azure.Policy/category":"App Service"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/2b9ad585-36bc-4615-b300-fd4435808332","Azure.Policy/version":"3.0.0"}},"spec":{"type":["Microsoft.Web/sites"],"where":{"allOf":[{"equals":"Microsoft.Web/sites","type":"."},{"field":"kind","notContains":"functionapp"}]},"condition":{"field":"resources","allOf":[{"anyOf":[{"field":"properties.managedServiceIdentityId","exists":true},{"field":"properties.xManagedServiceIdentityId","exists":true}]}],"where":{"allOf":[{"type":".","equals":"Microsoft.Web/sites/config"},{"name":".","equals":"web"}]}}}},{
// Synopsis: Azure Database for PostgreSQL allows you to choose the redundancy option for your database server. It can be set to a geo-redundant backup storage in which the data is not only stored within the region in which your server is hosted, but is also replicated to a paired region to provide recovery option in case of a region failure. Configuring geo-redundant storage for backup is only allowed during server create.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.91a95648ec07","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/48af4db5-9b8b-401c-8e74-076be876a430","Azure.Policy/version":"1.0.1"}},"spec":{"type":["Microsoft.DBforPostgreSQL/servers"],"condition":{"allOf":[{"equals":"Microsoft.DBforPostgreSQL/servers","type":"."},{"field":"properties.storageProfile.geoRedundantBackup","notEquals":"Enabled"}]}}},{
// Synopsis: Client certificates allow for the app to request a certificate for incoming requests. Only clients that have a valid certificate will be able to reach the app.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.f35b4954cba2","tags":{"Azure.Policy/category":"App Service"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/5bb220d9-2698-4ee4-8404-b9c30c9df609","Azure.Policy/version":"3.0.0"}},"spec":{"type":["Microsoft.Web/sites"],"condition":{"allOf":[{"equals":"Microsoft.Web/sites","type":"."},{"field":"kind","notContains":"functionapp"},{"anyOf":[{"field":"properties.clientCertEnabled","exists":false},{"field":"properties.clientCertEnabled","equals":"false"}]}]}}},{
// Synopsis: Azure Database for MySQL allows you to choose the redundancy option for your database server. It can be set to a geo-redundant backup storage in which the data is not only stored within the region in which your server is hosted, but is also replicated to a paired region to provide recovery option in case of a region failure. Configuring geo-redundant storage for backup is only allowed during server create.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.408b5ef602e6","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/82339799-d096-41ae-8538-b108becf0970","Azure.Policy/version":"1.0.1"}},"spec":{"type":["Microsoft.DBforMySQL/servers"],"condition":{"allOf":[{"equals":"Microsoft.DBforMySQL/servers","type":"."},{"field":"properties.storageProfile.geoRedundantBackup","notEquals":"Enabled"}]}}},{
// Synopsis: Periodically, newer versions are released for TLS either due to security flaws, include additional functionality, and enhance speed. Upgrade to the latest TLS version for App Service apps to take advantage of security fixes, if any, and/or new functionalities of the latest version.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.3d108a3088f1","tags":{"Azure.Policy/category":"App Service"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/f0e6e85b-9b9f-4a4b-b67b-f730d42f1b0b","Azure.Policy/version":"2.0.1"}},"spec":{"type":["Microsoft.Web/sites"],"where":{"allOf":[{"equals":"Microsoft.Web/sites","type":"."},{"field":"kind","notContains":"functionapp"}]},"condition":{"field":"resources","allOf":[{"field":"properties.minTlsVersion","equals":"1.2"}],"where":{"allOf":[{"type":".","equals":"Microsoft.Web/sites/config"},{"name":".","equals":"web"}]}}}},{
// Synopsis: Periodically, newer versions are released for TLS either due to security flaws, include additional functionality, and enhance speed. Upgrade to the latest TLS version for Function apps to take advantage of security fixes, if any, and/or new functionalities of the latest version.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.f898e3e09e76","tags":{"Azure.Policy/category":"App Service"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/f9d614c5-c173-4d56-95a7-b4437057d193","Azure.Policy/version":"2.0.1"}},"spec":{"type":["Microsoft.Web/sites"],"where":{"allOf":[{"equals":"Microsoft.Web/sites","type":"."},{"field":"kind","contains":"functionapp"},{"field":"kind","notContains":"workflowapp"}]},"condition":{"field":"resources","allOf":[{"field":"properties.minTlsVersion","equals":"1.2"}],"where":{"allOf":[{"type":".","equals":"Microsoft.Web/sites/config"},{"name":".","equals":"web"}]}}}},{
// Synopsis: Periodically, newer versions are released for PHP software either due to security flaws or to include additional functionality. Using the latest PHP version for App Service apps is recommended in order to take advantage of security fixes, if any, and/or new functionalities of the latest version. Currently, this policy only applies to Linux apps.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.35c22e8ea6a8","tags":{"Azure.Policy/category":"App Service"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/7261b898-8a84-4db8-9e04-18527132abb3","Azure.Policy/version":"3.0.0"}},"spec":{"type":["Microsoft.Web/sites"],"where":{"allOf":[{"equals":"Microsoft.Web/sites","type":"."},{"field":"kind","notContains":"functionapp"},{"field":"kind","contains":"linux"}]},"condition":{"field":"resources","allOf":[{"anyOf":[{"field":"properties.linuxFxVersion","notContains":"PHP"},{"field":"properties.linuxFxVersion","equals":"PHP|8.0"}]}],"where":{"allOf":[{"type":".","equals":"Microsoft.Web/sites/config"},{"name":".","equals":"web"}]}}}},{
// Synopsis: Periodically, newer versions are released for Java software either due to security flaws or to include additional functionality. Using the latest Java version for web apps is recommended in order to take advantage of security fixes, if any, and/or new functionalities of the latest version. Currently, this policy only applies to Linux apps.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.be46163c117f","tags":{"Azure.Policy/category":"App Service"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/496223c3-ad65-4ecd-878a-bae78737e9ed","Azure.Policy/version":"3.0.0"}},"spec":{"type":["Microsoft.Web/sites"],"where":{"allOf":[{"equals":"Microsoft.Web/sites","type":"."},{"field":"kind","notContains":"functionapp"},{"field":"kind","contains":"linux"}]},"condition":{"field":"resources","allOf":[{"anyOf":[{"field":"properties.linuxFxVersion","notContains":"JAVA"},{"field":"properties.linuxFxVersion","like":"*11"}]}],"where":{"allOf":[{"type":".","equals":"Microsoft.Web/sites/config"},{"name":".","equals":"web"}]}}}},{
// Synopsis: Periodically, newer versions are released for Java software either due to security flaws or to include additional functionality. Using the latest Java version for Function apps is recommended in order to take advantage of security fixes, if any, and/or new functionalities of the latest version. Currently, this policy only applies to Linux apps.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.0ffcb2141b9b","tags":{"Azure.Policy/category":"App Service"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/9d0b6ea4-93e2-4578-bf2f-6bb17d22b4bc","Azure.Policy/version":"3.0.0"}},"spec":{"type":["Microsoft.Web/sites"],"where":{"allOf":[{"equals":"Microsoft.Web/sites","type":"."},{"field":"kind","contains":"functionapp"},{"field":"kind","notContains":"workflowapp"},{"field":"kind","contains":"linux"}]},"condition":{"field":"resources","allOf":[{"anyOf":[{"field":"properties.linuxFxVersion","notContains":"JAVA"},{"field":"properties.linuxFxVersion","like":"*11"}]}],"where":{"allOf":[{"type":".","equals":"Microsoft.Web/sites/config"},{"name":".","equals":"web"}]}}}},{
// Synopsis: Periodically, newer versions are released for Python software either due to security flaws or to include additional functionality. Using the latest Python version for App Service apps is recommended in order to take advantage of security fixes, if any, and/or new functionalities of the latest version. This policy only applies to Linux apps.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.d94c6ce4a145","tags":{"Azure.Policy/category":"App Service"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/7008174a-fd10-4ef0-817e-fc820a951d73","Azure.Policy/version":"4.0.0"}},"spec":{"type":["Microsoft.Web/sites"],"where":{"allOf":[{"equals":"Microsoft.Web/sites","type":"."},{"field":"kind","notContains":"functionapp"},{"field":"kind","contains":"linux"}]},"condition":{"field":"resources","allOf":[{"anyOf":[{"field":"properties.linuxFxVersion","notContains":"PYTHON"},{"field":"properties.linuxFxVersion","equals":"PYTHON|3.9"}]}],"where":{"allOf":[{"type":".","equals":"Microsoft.Web/sites/config"},{"name":".","equals":"web"}]}}}},{
// Synopsis: Periodically, newer versions are released for Python software either due to security flaws or to include additional functionality. Using the latest Python version for Function apps is recommended in order to take advantage of security fixes, if any, and/or new functionalities of the latest version. This policy only applies to Linux apps since Python is not supported on Windows apps.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.45cd2b5c0b00","tags":{"Azure.Policy/category":"App Service"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/7238174a-fd10-4ef0-817e-fc820a951d73","Azure.Policy/version":"4.0.0"}},"spec":{"type":["Microsoft.Web/sites"],"where":{"allOf":[{"equals":"Microsoft.Web/sites","type":"."},{"field":"kind","contains":"functionapp"},{"field":"kind","notContains":"workflowapp"},{"field":"kind","contains":"linux"}]},"condition":{"field":"resources","allOf":[{"anyOf":[{"field":"properties.linuxFxVersion","notContains":"PYTHON"},{"field":"properties.linuxFxVersion","equals":"PYTHON|3.9"}]}],"where":{"allOf":[{"type":".","equals":"Microsoft.Web/sites/config"},{"name":".","equals":"web"}]}}}},{
// Synopsis: Private endpoint connections enforce secure communication by enabling private connectivity to Azure Database for PostgreSQL. Configure a private endpoint connection to enable access to traffic coming only from known networks and prevent access from all other IP addresses, including within Azure.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.797cd30a1bfa","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/0564d078-92f5-4f97-8398-b9f58a51f70b","Azure.Policy/version":"1.0.2"}},"spec":{"type":["Microsoft.DBforPostgreSQL/servers"],"where":{"equals":"Microsoft.DBforPostgreSQL/servers","type":"."},"condition":{"field":"resources","allOf":[{"field":"properties.privateLinkServiceConnectionState.status","equals":"Approved"}],"where":{"type":".","equals":"Microsoft.DBforPostgreSQL/servers/privateEndpointConnections"}}}},{
// Synopsis: Private endpoint connections enforce secure communication by enabling private connectivity to Azure Database for MariaDB. Configure a private endpoint connection to enable access to traffic coming only from known networks and prevent access from all other IP addresses, including within Azure.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.c7ddeec74a53","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/0a1302fb-a631-4106-9753-f3d494733990","Azure.Policy/version":"1.0.2"}},"spec":{"type":["Microsoft.DBforMariaDB/servers"],"where":{"equals":"Microsoft.DBforMariaDB/servers","type":"."},"condition":{"field":"resources","allOf":[{"field":"properties.privateLinkServiceConnectionState.status","equals":"Approved"}],"where":{"type":".","equals":"Microsoft.DBforMariaDB/servers/privateEndpointConnections"}}}},{
// Synopsis: Private endpoint connections enforce secure communication by enabling private connectivity to Azure Database for MySQL. Configure a private endpoint connection to enable access to traffic coming only from known networks and prevent access from all other IP addresses, including within Azure.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.1040e9d136dc","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/7595c971-233d-4bcf-bd18-596129188c49","Azure.Policy/version":"1.0.2"}},"spec":{"type":["Microsoft.DBforMySQL/servers"],"where":{"equals":"Microsoft.DBforMySQL/servers","type":"."},"condition":{"field":"resources","allOf":[{"field":"properties.privateLinkServiceConnectionState.status","equals":"Approved"}],"where":{"type":".","equals":"Microsoft.DBforMySQL/servers/privateEndpointConnections"}}}},{
// Synopsis: For incident investigation purposes, we recommend setting the data retention for your SQL Server' auditing to storage account destination to at least 90 days. Confirm that you are meeting the necessary retention rules for the regions in which you are operating. This is sometimes required for compliance with regulatory standards.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.c38c341b8ea9","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/89099bee-89e0-4b26-a5f4-165451757743","Azure.Policy/version":"3.0.0"}},"spec":{"type":["Microsoft.Sql/servers"],"where":{"allOf":[{"equals":"Microsoft.Sql/servers","type":"."},{"field":"kind","notContains":"analytics"}]},"condition":{"field":"resources","allOf":[{"anyOf":[{"allOf":[{"field":"properties.isAzureMonitorTargetEnabled","equals":true},{"field":"properties.storageEndpoint","equals":""}]},{"field":"properties.retentionDays","equals":0},{"field":"properties.retentionDays","greaterOrEquals":90}]}],"where":{"allOf":[{"type":".","equals":"Microsoft.Sql/servers/auditingSettings"},{"name":".","equals":"default"}]}}}},{
// Synopsis: Enable FTPS enforcement for enhanced security.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.211b7442e3fd","tags":{"Azure.Policy/category":"App Service"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/399b2637-a50f-4f95-96f8-3a145476eb15","Azure.Policy/version":"3.0.0"}},"spec":{"type":["Microsoft.Web/sites"],"where":{"allOf":[{"equals":"Microsoft.Web/sites","type":"."},{"field":"kind","contains":"functionapp"},{"field":"kind","notContains":"workflowapp"}]},"condition":{"field":"resources","allOf":[{"field":"properties.ftpsState","in":["FtpsOnly","Disabled"]}],"where":{"allOf":[{"type":".","equals":"Microsoft.Web/sites/config"},{"name":".","equals":"web"}]}}}},{
// Synopsis: Enable FTPS enforcement for enhanced security.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.4eeefe12bdf1","tags":{"Azure.Policy/category":"App Service"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/4d24b6d4-5e53-4a4f-a7f4-618fa573ee4b","Azure.Policy/version":"3.0.0"}},"spec":{"type":["Microsoft.Web/sites"],"where":{"allOf":[{"equals":"Microsoft.Web/sites","type":"."},{"field":"kind","notContains":"functionapp"}]},"condition":{"field":"resources","allOf":[{"field":"properties.ftpsState","in":["FtpsOnly","Disabled"]}],"where":{"allOf":[{"type":".","equals":"Microsoft.Web/sites/config"},{"name":".","equals":"web"}]}}}},{
// Synopsis: Client certificates allow for the app to request a certificate for incoming requests. Only clients with valid certificates will be able to reach the app.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.071b659f6cf5","tags":{"Azure.Policy/category":"App Service"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/eaebaea7-8013-4ceb-9d14-7eb32271373c","Azure.Policy/version":"3.0.0"}},"spec":{"type":["Microsoft.Web/sites"],"condition":{"allOf":[{"equals":"Microsoft.Web/sites","type":"."},{"field":"kind","contains":"functionapp"},{"field":"kind","notContains":"workflowapp"},{"anyOf":[{"field":"properties.clientCertEnabled","exists":false},{"field":"properties.clientCertEnabled","equals":"false"}]}]}}},{
// Synopsis: Customer-managed keys are commonly required to meet regulatory compliance standards. Customer-managed keys enable the data stored in Cognitive Services to be encrypted with an Azure Key Vault key created and owned by you. You have full control and responsibility for the key lifecycle, including rotation and management. Learn more about customer-managed keys at https://go.microsoft.com/fwlink/?linkid=2121321.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.d57939cb74e4","tags":{"Azure.Policy/category":"Cognitive Services"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/67121cc7-ff39-4ab8-b7e3-95b84dab487d","Azure.Policy/version":"2.0.0"}},"spec":{"type":["Microsoft.CognitiveServices/accounts"],"condition":{"allOf":[{"equals":"Microsoft.CognitiveServices/accounts","type":"."},{"field":"properties.encryption.keySource","notEquals":"Microsoft.KeyVault"},{"greater":0,"field":"properties.capabilities[?@.name == 'CustomerManagedKey']"}]}}},{
// Synopsis: Use customer-managed keys to manage the encryption at rest of your Azure Cosmos DB. By default, the data is encrypted at rest with service-managed keys, but customer-managed keys are commonly required to meet regulatory compliance standards. Customer-managed keys enable the data to be encrypted with an Azure Key Vault key created and owned by you. You have full control and responsibility for the key lifecycle, including rotation and management. Learn more at https://aka.ms/cosmosdb-cmk.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.17447f145e3f","tags":{"Azure.Policy/category":"Cosmos DB"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/1f905d99-2ab7-462c-a6b0-f709acca6c8f","Azure.Policy/version":"1.1.0"}},"spec":{"type":["Microsoft.DocumentDB/databaseAccounts"],"condition":{"allOf":[{"field":"properties.keyVaultKeyUri","exists":false},{"equals":"Microsoft.DocumentDB/databaseAccounts","type":"."}]}}},{
// Synopsis: Disabling local authentication methods improves security by ensuring that Cosmos DB database accounts exclusively require Azure Active Directory identities for authentication. Learn more at: https://docs.microsoft.com/azure/cosmos-db/how-to-setup-rbac#disable-local-auth.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.f7db58b72117","tags":{"Azure.Policy/category":"Cosmos DB"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/5450f5bd-9c72-4390-a9c4-a7aba4edfdd2","Azure.Policy/version":"1.0.0"}},"spec":{"type":["Microsoft.DocumentDB/databaseAccounts"],"condition":{"allOf":[{"equals":"Microsoft.DocumentDB/databaseAccounts","type":"."},{"field":"properties.disableLocalAuth","notEquals":true}]}}},{
// Synopsis: Deleting a key vault without soft delete enabled permanently deletes all secrets, keys, and certificates stored in the key vault. Accidental deletion of a key vault can lead to permanent data loss. Soft delete allows you to recover an accidentally deleted key vault for a configurable retention period.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.45e952e505c2","tags":{"Azure.Policy/category":"Key Vault"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/1e66c121-a66a-4b1f-9b83-0fd99bf0fc2d","Azure.Policy/version":"3.0.0"}},"spec":{"type":["Microsoft.KeyVault/vaults"],"condition":{"allOf":[{"equals":"Microsoft.KeyVault/vaults","type":"."},{"not":{"field":"properties.createMode","equals":"recover"}},{"anyOf":[{"allOf":[{"less":"2019-09-01","field":"apiVersion"},{"anyOf":[{"field":"properties.enableSoftDelete","equals":"false"},{"field":"properties.enableSoftDelete","exists":false}]}]},{"allOf":[{"greaterOrEquals":"2019-09-01","field":"apiVersion"},{"field":"properties.enableSoftDelete","equals":"false"}]}]}]}}},{
// Synopsis: Private endpoints lets you connect your virtual network to Azure services without a public IP address at the source or destination. By mapping private endpoints to your Azure Cache for Redis instances, data leakage risks are reduced. Learn more at: https://docs.microsoft.com/azure/azure-cache-for-redis/cache-private-link.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.16aea66602cb","tags":{"Azure.Policy/category":"Cache"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/7803067c-7d34-46e3-8c79-0ca68fc4036d","Azure.Policy/version":"1.0.0"}},"spec":{"type":["Microsoft.Cache/redis"],"where":{"equals":"Microsoft.Cache/redis","type":"."},"condition":{"field":"resources","allOf":[{"field":"properties.privateLinkServiceConnectionState.status","equals":"Approved"}],"where":{"type":".","equals":"Microsoft.Cache/redis/privateEndpointConnections"}}}},{
// Synopsis: Secure your blob and file storage account with greater flexibility using customer-managed keys. When you specify a customer-managed key, that key is used to protect and control access to the key that encrypts your data. Using customer-managed keys provides additional capabilities to control rotation of the key encryption key or cryptographically erase data.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.c55116b1e588","tags":{"Azure.Policy/category":"Storage"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/6fac406b-40ca-413b-bf8e-0bf964659c25","Azure.Policy/version":"1.0.3"}},"spec":{"type":["Microsoft.Storage/storageAccounts"],"condition":{"allOf":[{"equals":"Microsoft.Storage/storageAccounts","type":"."},{"not":{"field":"properties.encryption.keySource","equals":"Microsoft.Keyvault"}}]}}},{
// Synopsis: Protect your storage accounts from potential threats using virtual network rules as a preferred method instead of IP-based filtering. Disabling IP-based filtering prevents public IPs from accessing your storage accounts.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.7509795589cc","tags":{"Azure.Policy/category":"Storage"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/2a1a9cdf-e04d-429a-8416-3bfb72a1b26f","Azure.Policy/version":"1.0.1"}},"spec":{"type":["Microsoft.Storage/storageAccounts"],"condition":{"allOf":[{"equals":"Microsoft.Storage/storageAccounts","type":"."},{"anyOf":[{"field":"properties.networkAcls.defaultAction","notEquals":"Deny"},{"greaterOrEquals":1,"field":"properties.networkAcls.ipRules[*]"}]}]}}},{
// Synopsis: Use customer-managed keys to manage the encryption at rest of the contents of your registries. By default, the data is encrypted at rest with service-managed keys, but customer-managed keys are commonly required to meet regulatory compliance standards. Customer-managed keys enable the data to be encrypted with an Azure Key Vault key created and owned by you. You have full control and responsibility for the key lifecycle, including rotation and management. Learn more at https://aka.ms/acr/CMK.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.2181109a2413","tags":{"Azure.Policy/category":"Container Registry"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/5b9159ae-1701-4a6f-9a7a-aa9c8ddd0580","Azure.Policy/version":"1.1.2"}},"spec":{"type":["Microsoft.ContainerRegistry/registries"],"condition":{"allOf":[{"equals":"Microsoft.ContainerRegistry/registries","type":"."},{"field":"properties.encryption.status","notEquals":"enabled"}]}}},{
// Synopsis: Azure container registries by default accept connections over the internet from hosts on any network. To protect your registries from potential threats, allow access from only specific private endpoints, public IP addresses or address ranges. If your registry doesn't have network rules configured, it will appear in the unhealthy resources. Learn more about Container Registry network rules here: https://aka.ms/acr/privatelink, https://aka.ms/acr/portal/public-network and https://aka.ms/acr/vnet.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.12b03c89d7f2","tags":{"Azure.Policy/category":"Container Registry"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/d0793b48-0edc-4296-a390-4c75d1bdfd71","Azure.Policy/version":"2.0.0"}},"spec":{"type":["Microsoft.ContainerRegistry/registries"],"condition":{"allOf":[{"equals":"Microsoft.ContainerRegistry/registries","type":"."},{"allOf":[{"anyof":[{"field":"properties.networkRuleSet.defaultAction","exists":false},{"field":"properties.networkRuleSet.defaultAction","equals":"Allow"}]},{"anyof":[{"field":"properties.publicNetworkAccess","exists":false},{"field":"properties.publicNetworkAccess","equals":"Enabled"}]}]}]}}},{
// Synopsis: Azure Private Link lets you connect your virtual network to Azure services without a public IP address at the source or destination. The private link platform handles the connectivity between the consumer and services over the Azure backbone network.By mapping private endpoints to your container registries instead of the entire service, you'll also be protected against data leakage risks. Learn more at: https://aka.ms/acr/private-link.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.0c6a38c728d9","tags":{"Azure.Policy/category":"Container Registry"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/e8eef0a8-67cf-4eb4-9386-14b0e78733d4","Azure.Policy/version":"1.0.1"}},"spec":{"type":["Microsoft.ContainerRegistry/registries"],"condition":{"allOf":[{"equals":"Microsoft.ContainerRegistry/registries","type":"."},{"less":1,"field":"properties.privateEndpointConnections[?@.properties.privateLinkServiceConnectionState.status == 'Approved']"}]}}},{
// Synopsis: Azure Private Link lets you connect your virtual network to Azure services without a public IP address at the source or destination. The private link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to your app configuration instances instead of the entire service, you'll also be protected against data leakage risks. Learn more at: https://aka.ms/appconfig/private-endpoint.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.2bc92debae4b","tags":{"Azure.Policy/category":"App Configuration"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/ca610c1d-041c-4332-9d88-7ed3094967c7","Azure.Policy/version":"1.0.2"}},"spec":{"type":["Microsoft.AppConfiguration/configurationStores"],"where":{"equals":"Microsoft.AppConfiguration/configurationStores","type":"."},"condition":{"field":"resources","allOf":[{"field":"properties.privateLinkServiceConnectionState.status","equals":"Approved"}],"where":{"type":".","equals":"Microsoft.AppConfiguration/configurationStores/privateEndpointConnections"}}}},{
// Synopsis: Azure Private Link lets you connect your virtual network to Azure services without a public IP address at the source or destination. The Private Link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to your Event Grid domain instead of the entire service, you'll also be protected against data leakage risks. Learn more at: https://aka.ms/privateendpoints.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.f8cafc3b1049","tags":{"Azure.Policy/category":"Event Grid"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/9830b652-8523-49cc-b1b3-e17dce1127ca","Azure.Policy/version":"1.0.2"}},"spec":{"type":["Microsoft.EventGrid/domains"],"condition":{"allOf":[{"equals":"Microsoft.EventGrid/domains","type":"."},{"less":1,"field":"properties.privateEndpointConnections[?@.properties.privateLinkServiceConnectionState.status == 'Approved']"}]}}},{
// Synopsis: Azure Private Link lets you connect your virtual network to Azure services without a public IP address at the source or destination. The Private Link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to your Event Grid topic instead of the entire service, you'll also be protected against data leakage risks. Learn more at: https://aka.ms/privateendpoints.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.4f87e86f3144","tags":{"Azure.Policy/category":"Event Grid"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/4b90e17e-8448-49db-875e-bd83fb6f804f","Azure.Policy/version":"1.0.2"}},"spec":{"type":["Microsoft.EventGrid/topics"],"condition":{"allOf":[{"equals":"Microsoft.EventGrid/topics","type":"."},{"field":"kind","notEquals":"AzureArc"},{"less":1,"field":"properties.privateEndpointConnections[?@.properties.privateLinkServiceConnectionState.status == 'Approved']"}]}}},{
// Synopsis: Azure Private Link lets you connect your virtual network to Azure services without a public IP address at the source or destination. The private link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to your Azure SignalR Service resource instead of the entire service, you'll reduce your data leakage risks. Learn more about private links at: https://aka.ms/asrs/privatelink.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.64149a63be72","tags":{"Azure.Policy/category":"SignalR"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/2393d2cf-a342-44cd-a2e2-fe0188fd1234","Azure.Policy/version":"1.0.0"}},"spec":{"type":["Microsoft.SignalRService/SignalR"],"condition":{"allOf":[{"equals":"Microsoft.SignalRService/SignalR","type":"."},{"less":1,"field":"properties.privateEndpointConnections[?@.properties.privateLinkServiceConnectionState.status == 'Approved']"}]}}},{
// Synopsis: Manage encryption at rest of Azure Machine Learning workspace data with customer-managed keys. By default, customer data is encrypted with service-managed keys, but customer-managed keys are commonly required to meet regulatory compliance standards. Customer-managed keys enable the data to be encrypted with an Azure Key Vault key created and owned by you. You have full control and responsibility for the key lifecycle, including rotation and management. Learn more at https://aka.ms/azureml-workspaces-cmk.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.30ca59752835","tags":{"Azure.Policy/category":"Machine Learning"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/ba769a63-b8cc-4b2d-abf6-ac33c7204be8","Azure.Policy/version":"1.0.3"}},"spec":{"type":["Microsoft.MachineLearningServices/workspaces"],"condition":{"allOf":[{"equals":"Microsoft.MachineLearningServices/workspaces","type":"."},{"not":{"field":"properties.encryption.status","equals":"enabled"}}]}}},{
// Synopsis: Azure Private Link lets you connect your virtual network to Azure services without a public IP address at the source or destination. The Private Link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to Azure Machine Learning workspaces, data leakage risks are reduced. Learn more about private links at: https://docs.microsoft.com/azure/machine-learning/how-to-configure-private-link.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.6221a1014884","tags":{"Azure.Policy/category":"Machine Learning"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/40cec1dd-a100-4920-b15b-3024fe8901ab","Azure.Policy/version":"1.1.0"}},"spec":{"type":["Microsoft.MachineLearningServices/workspaces"],"condition":{"allOf":[{"equals":"Microsoft.MachineLearningServices/workspaces","type":"."},{"less":1,"field":"properties.privateEndpointConnections[?@.properties.privateLinkServiceConnectionState.status == 'Approved']"}]}}},{
// Synopsis: Deploy Azure Web Application Firewall (WAF) in front of public facing web applications for additional inspection of incoming traffic. Web Application Firewall (WAF) provides centralized protection of your web applications from common exploits and vulnerabilities such as SQL injections, Cross-Site Scripting, local and remote file executions. You can also restrict access to your web applications by countries, IP address ranges, and other http(s) parameters via custom rules.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.75ab26320f69","tags":{"Azure.Policy/category":"Network"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/055aa869-bc98-4af8-bafc-23f1ab6ffe2c","Azure.Policy/version":"1.0.2"}},"spec":{"type":["Microsoft.Network/frontdoors"],"condition":{"allOf":[{"equals":"Microsoft.Network/frontdoors","type":"."},{"field":"properties.frontendEndpoints[*].properties.webApplicationFirewallPolicyLink.id","exists":false}]}}},{
// Synopsis: Deploy Azure Web Application Firewall (WAF) in front of public facing web applications for additional inspection of incoming traffic. Web Application Firewall (WAF) provides centralized protection of your web applications from common exploits and vulnerabilities such as SQL injections, Cross-Site Scripting, local and remote file executions. You can also restrict access to your web applications by countries, IP address ranges, and other http(s) parameters via custom rules.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.670192ec6ede","tags":{"Azure.Policy/category":"Network"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/564feb30-bf6a-4854-b4bb-0d2d2d1e6c66","Azure.Policy/version":"2.0.0"}},"spec":{"type":["Microsoft.Network/applicationGateways"],"condition":{"allOf":[{"equals":"Microsoft.Network/applicationGateways","type":"."},{"field":"properties.webApplicationFirewallConfiguration","exists":false},{"field":"properties.firewallPolicy","exists":false}]}}},{
// Synopsis: Disable the public network access property to improve security and ensure your Azure Database for MariaDB can only be accessed from a private endpoint. This configuration strictly disables access from any public address space outside of Azure IP range, and denies all logins that match IP or virtual network-based firewall rules.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.1c3c2b702f70","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/fdccbe47-f3e3-4213-ad5d-ea459b2fa077","Azure.Policy/version":"2.0.0"}},"spec":{"type":["Microsoft.DBforMariaDB/servers"],"condition":{"allOf":[{"equals":"Microsoft.DBforMariaDB/servers","type":"."},{"field":"properties.publicNetworkAccess","notEquals":"Disabled"}]}}},{
// Synopsis: Disable the public network access property to improve security and ensure your Azure Database for MySQL can only be accessed from a private endpoint. This configuration strictly disables access from any public address space outside of Azure IP range, and denies all logins that match IP or virtual network-based firewall rules.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.c125f19a1212","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/d9844e8a-1437-4aeb-a32c-0c992f056095","Azure.Policy/version":"2.0.0"}},"spec":{"type":["Microsoft.DBforMySQL/servers"],"condition":{"allOf":[{"equals":"Microsoft.DBforMySQL/servers","type":"."},{"field":"properties.publicNetworkAccess","notEquals":"Disabled"}]}}},{
// Synopsis: Use customer-managed keys to manage the encryption at rest of your MySQL servers. By default, the data is encrypted at rest with service-managed keys, but customer-managed keys are commonly required to meet regulatory compliance standards. Customer-managed keys enable the data to be encrypted with an Azure Key Vault key created and owned by you. You have full control and responsibility for the key lifecycle, including rotation and management.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.d1949814f763","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/83cef61d-dbd1-4b20-a4fc-5fbc7da10833","Azure.Policy/version":"1.0.4"}},"spec":{"type":["Microsoft.DBforMySQL/servers"],"where":{"equals":"Microsoft.DBforMySQL/servers","type":"."},"condition":{"field":"resources","allOf":[{"allOf":[{"field":"properties.serverKeyType","equals":"AzureKeyVault"},{"field":"properties.uri","notEquals":""},{"field":"properties.uri","exists":true}]}],"where":{"type":".","equals":"Microsoft.DBforMySQL/servers/keys"}}}},{
// Synopsis: Disable the public network access property to improve security and ensure your Azure Database for PostgreSQL can only be accessed from a private endpoint. This configuration disables access from any public address space outside of Azure IP range, and denies all logins that match IP or virtual network-based firewall rules.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.9054789e2bd7","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/b52376f7-9612-48a1-81cd-1ffe4b61032c","Azure.Policy/version":"2.0.0"}},"spec":{"type":["Microsoft.DBforPostgreSQL/servers"],"condition":{"allOf":[{"equals":"Microsoft.DBforPostgreSQL/servers","type":"."},{"field":"properties.publicNetworkAccess","notEquals":"Disabled"}]}}},{
// Synopsis: Use customer-managed keys to manage the encryption at rest of your PostgreSQL servers. By default, the data is encrypted at rest with service-managed keys, but customer-managed keys are commonly required to meet regulatory compliance standards. Customer-managed keys enable the data to be encrypted with an Azure Key Vault key created and owned by you. You have full control and responsibility for the key lifecycle, including rotation and management.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.1fc01a56285d","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/18adea5e-f416-4d0f-8aa8-d24321e3e274","Azure.Policy/version":"1.0.4"}},"spec":{"type":["Microsoft.DBforPostgreSQL/servers"],"where":{"equals":"Microsoft.DBforPostgreSQL/servers","type":"."},"condition":{"field":"resources","allOf":[{"allOf":[{"field":"properties.serverKeyType","equals":"AzureKeyVault"},{"field":"properties.uri","notEquals":""},{"field":"properties.uri","exists":true}]}],"where":{"type":".","equals":"Microsoft.DBforPostgreSQL/servers/keys"}}}},{
// Synopsis: Azure Private Link lets you connect your virtual network to Azure services without a public IP address at the source or destination. The Private Link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to your VM Image Builder building resources, data leakage risks are reduced. Learn more about private links at: https://docs.microsoft.com/azure/virtual-machines/linux/image-builder-networking#deploy-using-an-existing-vnet.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.830df7436e24","tags":{"Azure.Policy/category":"VM Image Builder"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/2154edb9-244f-4741-9970-660785bccdaa","Azure.Policy/version":"1.1.0"}},"spec":{"type":["Microsoft.VirtualMachineImages/imageTemplates"],"condition":{"allOf":[{"equals":"Microsoft.VirtualMachineImages/imageTemplates","type":"."},{"field":"properties.vmProfile.vnetConfig","exists":false}]}}},{
// Synopsis: Enable the key vault firewall so that the key vault is not accessible by default to any public IPs. You can then configure specific IP ranges to limit access to those networks. Learn more at: https://docs.microsoft.com/azure/key-vault/general/network-security
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.d5515d69b86b","tags":{"Azure.Policy/category":"Key Vault"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/55615ac9-af46-4a59-874e-391cc3dfb490","Azure.Policy/version":"3.0.0"}},"spec":{"type":["Microsoft.KeyVault/vaults"],"condition":{"allOf":[{"equals":"Microsoft.KeyVault/vaults","type":"."},{"field":"properties.createMode","notEquals":"recover"},{"field":"properties.networkAcls.defaultAction","notEquals":"Deny"}]}}},{
// Synopsis: Private link provides a way to connect Key Vault to your Azure resources without sending traffic over the public internet. Private link provides defense in depth protection against data exfiltration.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.f761996cefa7","tags":{"Azure.Policy/category":"Key Vault"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/5f0bc445-3935-4915-9981-011aa2b46147","Azure.Policy/version":"1.1.0-preview"}},"spec":{"type":["Microsoft.KeyVault/vaults"],"condition":{"allOf":[{"equals":"Microsoft.KeyVault/vaults","type":"."},{"anyOf":[{"field":"properties.privateEndpointConnections","exists":false},{"field":"properties.privateEndpointConnections[*]","count":0}]}]}}},{
// Synopsis: Azure Spring Cloud instances should use virtual network injection for the following purposes: 1. Isolate Azure Spring Cloud from Internet. 2. Enable Azure Spring Cloud to interact with systems in either on premises data centers or Azure service in other virtual networks. 3. Empower customers to control inbound and outbound network communications for Azure Spring Cloud.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.3d5f79b7fdbc","tags":{"Azure.Policy/category":"App Platform"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/af35e2a4-ef96-44e7-a9ae-853dd97032c4","Azure.Policy/version":"1.1.0"}},"spec":{"type":["Microsoft.AppPlatform/Spring"],"condition":{"allOf":[{"equals":"Microsoft.AppPlatform/Spring","type":"."},{"field":"sku.tier","in":["Standard"]},{"field":"properties.networkProfile.serviceRuntimeSubnetId","exists":false}]}}},{
// Synopsis: To ensure the relevant people in your organization are notified when there is a potential security breach in one of your subscriptions, set a security contact to receive email notifications from Security Center.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.351d7b280255","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/4f4f78b8-e367-4b10-a341-d9a4ad5cf1c7","Azure.Policy/version":"1.0.1"}},"spec":{"type":["Microsoft.Resources/subscriptions"],"where":{"equals":"Microsoft.Resources/subscriptions","type":"."},"condition":{"field":"resources","allOf":[{"field":"properties.emails","notEquals":""}],"where":{"type":".","equals":"Microsoft.Security/securityContacts"}}}},{
// Synopsis: To monitor for security vulnerabilities and threats, Azure Security Center collects data from your Azure virtual machines. Data is collected by the Log Analytics agent, formerly known as the Microsoft Monitoring Agent (MMA), which reads various security-related configurations and event logs from the machine and copies the data to your Log Analytics workspace for analysis. We recommend enabling auto provisioning to automatically deploy the agent to all supported Azure VMs and any new ones that are created.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.7b5466c32e1b","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/475aae12-b88a-4572-8b36-9b712b2b3a17","Azure.Policy/version":"1.0.1"}},"spec":{"type":["Microsoft.Resources/subscriptions"],"where":{"equals":"Microsoft.Resources/subscriptions","type":"."},"condition":{"field":"resources","allOf":[{"field":"properties.autoProvision","equals":"On"}],"where":{"type":".","equals":"Microsoft.Security/autoProvisioningSettings"}}}},{
// Synopsis: To ensure the relevant people in your organization are notified when there is a potential security breach in one of your subscriptions, enable email notifications for high severity alerts in Security Center.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.8471fe7ed03e","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/6e2593d9-add6-4083-9c9b-4b7d2188c899","Azure.Policy/version":"1.0.1"}},"spec":{"type":["Microsoft.Resources/subscriptions"],"where":{"equals":"Microsoft.Resources/subscriptions","type":"."},"condition":{"field":"resources","allOf":[{"field":"properties.alertNotifications.state","notEquals":"Off"}],"where":{"type":".","equals":"Microsoft.Security/securityContacts"}}}},{
// Synopsis: To ensure your subscription owners are notified when there is a potential security breach in their subscription, set email notifications to subscription owners for high severity alerts in Security Center.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.6a85bfdd33d1","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/0b15565f-aa9e-48ba-8619-45960f2c314d","Azure.Policy/version":"2.0.0"}},"spec":{"type":["Microsoft.Resources/subscriptions"],"where":{"equals":"Microsoft.Resources/subscriptions","type":"."},"condition":{"field":"resources","allOf":[{"not":{"allOf":[{"field":"properties.notificationsByRole.state","equals":"Off"},{"field":"properties.alertNotifications.minimalSeverity","equals":"High"}]}}],"where":{"type":".","equals":"Microsoft.Security/securityContacts"}}}},{
// Synopsis: Azure Private Link lets you connect your virtual network to Azure services without a public IP address at the source or destination. The Private Link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to your storage account, data leakage risks are reduced. Learn more about private links at - https://aka.ms/azureprivatelinkoverview
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.73e34897e10b","tags":{"Azure.Policy/category":"Storage"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/6edd7eda-6dd8-40f7-810d-67160c639cd9","Azure.Policy/version":"2.0.0"}},"spec":{"type":["Microsoft.Storage/storageAccounts"],"where":{"equals":"Microsoft.Storage/storageAccounts","type":"."},"condition":{"field":"resources","allOf":[{"field":"properties.privateLinkServiceConnectionState.status","equals":"Approved"}],"where":{"type":".","equals":"Microsoft.Storage/storageAccounts/privateEndpointConnections"}}}},{
// Synopsis: Private endpoint connections enforce secure communication by enabling private connectivity to Azure SQL Database.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.a2c9c648dfa0","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/7698e800-9299-47a6-b3b6-5a0fee576eed","Azure.Policy/version":"1.1.0"}},"spec":{"type":["Microsoft.Sql/servers"],"condition":{"allOf":[{"equals":"Microsoft.Sql/servers","type":"."},{"less":1,"field":"properties.privateEndpointConnections[?@.properties.privateLinkServiceConnectionState.status == 'Approved']"}]}}},{
// Synopsis: Disabling the public network access property improves security by ensuring your Azure SQL Database can only be accessed from a private endpoint. This configuration denies all logins that match IP or virtual network based firewall rules.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.035352ae2528","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/1b8ca024-1d5c-4dec-8995-b1a932b41780","Azure.Policy/version":"1.1.0"}},"spec":{"type":["Microsoft.Sql/servers"],"condition":{"allOf":[{"equals":"Microsoft.Sql/servers","type":"."},{"field":"properties.publicNetworkAccess","notEquals":"Disabled"}]}}},{
// Synopsis: Network access to Cognitive Services accounts should be restricted. Configure network rules so only applications from allowed networks can access the Cognitive Services account. To allow connections from specific internet or on-premises clients, access can be granted to traffic from specific Azure virtual networks or to public internet IP address ranges.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.f65df8a0e5b6","tags":{"Azure.Policy/category":"Cognitive Services"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/037eea7a-bd0a-46c5-9a66-03aea78705d3","Azure.Policy/version":"3.0.0"}},"spec":{"type":["Microsoft.CognitiveServices/accounts"],"condition":{"allOf":[{"equals":"Microsoft.CognitiveServices/accounts","type":"."},{"field":"properties.networkAcls.defaultAction","notEquals":"Deny"}]}}},{
// Synopsis: Disabling public network access improves security by ensuring that Cognitive Services account isn't exposed on the public internet. Creating private endpoints can limit exposure of Cognitive Services account. Learn more at: https://go.microsoft.com/fwlink/?linkid=2129800. 
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.6aa17afd2bc3","tags":{"Azure.Policy/category":"Cognitive Services"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/0725b4dd-7e76-479c-a735-68e7ee23d5ca","Azure.Policy/version":"3.0.0"}},"spec":{"type":["Microsoft.CognitiveServices/accounts"],"condition":{"allOf":[{"equals":"Microsoft.CognitiveServices/accounts","type":"."},{"field":"properties.publicNetworkAccess","notEquals":"Disabled"}]}}},{
// Synopsis: Azure Virtual Network deployment provides enhanced security, isolation and allows you to place your API Management service in a non-internet routable network that you control access to. These networks can then be connected to your on-premises networks using various VPN technologies, which enables access to your backend services within the network and/or on-premises. The developer portal and API gateway, can be configured to be accessible either from the Internet or only within the virtual network.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.e2c46edb09f1","tags":{"Azure.Policy/category":"API Management"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/ef619a2c-cc4d-4d03-b2ba-8c94a834d85b","Azure.Policy/version":"1.0.1"}},"spec":{"type":["Microsoft.ApiManagement/service"],"condition":{"allOf":[{"equals":"Microsoft.ApiManagement/service","type":"."},{"field":"sku.name","in":["Developer","Premium"]},{"anyOf":[{"field":"properties.virtualNetworkType","exists":false},{"field":"properties.virtualNetworkType","equals":"None"}]}]}}},{
// Synopsis: Firewall rules should be defined on your Azure Cosmos DB accounts to prevent traffic from unauthorized sources. Accounts that have at least one IP rule defined with the virtual network filter enabled are deemed compliant. Accounts disabling public access are also deemed compliant.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.143441e63bc3","tags":{"Azure.Policy/category":"Cosmos DB"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/862e97cf-49fc-4a5c-9de4-40d4e2e7c8eb","Azure.Policy/version":"2.0.0"}},"spec":{"type":["Microsoft.DocumentDB/databaseAccounts"],"condition":{"allOf":[{"equals":"Microsoft.DocumentDB/databaseAccounts","type":"."},{"anyOf":[{"field":"properties.publicNetworkAccess","exists":false},{"field":"properties.publicNetworkAccess","equals":"Enabled"}]},{"anyOf":[{"field":"properties.isVirtualNetworkFilterEnabled","exists":false},{"field":"properties.isVirtualNetworkFilterEnabled","equals":"false"}]},{"allOf":[{"anyOf":[{"field":"properties.ipRules","exists":false},{"field":"properties.ipRules[*]","count":0}]},{"anyOf":[{"field":"properties.ipRangeFilter","exists":false},{"field":"properties.ipRangeFilter","equals":""}]}]}]}}},{
// Synopsis: Azure Defender for Resource Manager automatically monitors the resource management operations in your organization. Azure Defender detects threats and alerts you about suspicious activity. Learn more about the capabilities of Azure Defender for Resource Manager at https://aka.ms/defender-for-resource-manager . Enabling this Azure Defender plan results in charges. Learn about the pricing details per region on Security Center's pricing page: https://aka.ms/pricing-security-center .
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.6da1162dd0b0","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/c3d20c29-b36d-48fe-808b-99a87530ad99","Azure.Policy/version":"1.0.0"}},"spec":{"type":["Microsoft.Resources/subscriptions"],"where":{"equals":"Microsoft.Resources/subscriptions","type":"."},"condition":{"field":"resources","allOf":[{"field":"properties.pricingTier","equals":"Standard"}],"where":{"allOf":[{"type":".","equals":"Microsoft.Security/pricings"},{"name":".","equals":"Arm"}]}}}},{
// Synopsis: Azure Defender for DNS provides an additional layer of protection for your cloud resources by continuously monitoring all DNS queries from your Azure resources. Azure Defender alerts you about suspicious activity at the DNS layer. Learn more about the capabilities of Azure Defender for DNS at https://aka.ms/defender-for-dns . Enabling this Azure Defender plan results in charges. Learn about the pricing details per region on Security Center's pricing page: https://aka.ms/pricing-security-center .
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.13be4771fde8","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/bdc59948-5574-49b3-bb91-76b7c986428d","Azure.Policy/version":"1.0.0"}},"spec":{"type":["Microsoft.Resources/subscriptions"],"where":{"equals":"Microsoft.Resources/subscriptions","type":"."},"condition":{"field":"resources","allOf":[{"field":"properties.pricingTier","equals":"Standard"}],"where":{"allOf":[{"type":".","equals":"Microsoft.Security/pricings"},{"name":".","equals":"Dns"}]}}}},{
// Synopsis: Enable virtual TPM device on supported virtual machines to facilitate Measured Boot and other OS security features that require a TPM. Once enabled, vTPM can be used to attest boot integrity. This assessment only applies to trusted launch enabled virtual machines.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.b39bd9d947cf","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/1c30f9cd-b84c-49cc-aa2c-9288447cc3b3","Azure.Policy/version":"2.0.0-preview"}},"spec":{"type":["Microsoft.Compute/virtualMachines"],"condition":{"allOf":[{"equals":"Microsoft.Compute/virtualMachines","type":"."},{"field":"properties.securityProfile.securityType","equals":"TrustedLaunch"},{"field":"properties.securityProfile.uefiSettings","exists":true},{"field":"properties.securityProfile.uefiSettings.vTpmEnabled","notequals":"true"}]}}},{
// Synopsis: Enable Secure Boot on supported Windows virtual machines to mitigate against malicious and unauthorized changes to the boot chain. Once enabled, only trusted bootloaders, kernel and kernel drivers will be allowed to run. This assessment applies to Trusted Launch and Confidential Windows virtual machines.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.d588181e9f94","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/97566dd7-78ae-4997-8b36-1c7bfe0d8121","Azure.Policy/version":"4.0.0-preview"}},"spec":{"type":["Microsoft.Compute/virtualMachines"],"condition":{"allOf":[{"equals":"Microsoft.Compute/virtualMachines","type":"."},{"anyOf":[{"field":"properties.storageProfile.imageReference.offer","like":"windows*"},{"field":"properties.storageProfile.osDisk.osType","like":"Windows*"}]},{"field":"properties.securityProfile.securityType","in":["TrustedLaunch","ConfidentialVM"]},{"field":"properties.securityProfile.uefiSettings","exists":true},{"field":"properties.securityProfile.uefiSettings.secureBootEnabled","notequals":"true"}]}}},{
// Synopsis: Install Guest Attestation extension on supported Linux virtual machines to allow Azure Security Center to proactively attest and monitor the boot integrity. Once installed, boot integrity will be attested via Remote Attestation. This assessment applies to Trusted Launch and Confidential Linux virtual machines.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.1de20adb699b","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/672fe5a1-2fcd-42d7-b85d-902b6e28c6ff","Azure.Policy/version":"6.0.0-preview"}},"spec":{"type":["Microsoft.Compute/virtualMachines"],"where":{"allOf":[{"equals":"Microsoft.Compute/virtualMachines","type":"."},{"anyOf":[{"field":"properties.storageProfile.osDisk.osType","like":"Linux*"},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"Canonical"},{"field":"properties.storageProfile.imageReference.offer","equals":"UbuntuServer"},{"field":"properties.storageProfile.imageReference.sku","like":"18_04-lts-gen2"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"Canonical"},{"field":"properties.storageProfile.imageReference.offer","equals":"0001-com-ubuntu-server-focal"},{"field":"properties.storageProfile.imageReference.sku","like":"20_04-lts-gen2"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"Canonical"},{"field":"properties.storageProfile.imageReference.offer","equals":"0001-com-ubuntu-confidential-vm-focal"},{"field":"properties.storageProfile.imageReference.sku","like":"20_04-lts-cvm"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"RedHat"},{"field":"properties.storageProfile.imageReference.offer","equals":"RHEL"},{"field":"properties.storageProfile.imageReference.sku","like":"83-gen2"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"SUSE"},{"field":"properties.storageProfile.imageReference.offer","equals":"SLES-15-SP2"},{"field":"properties.storageProfile.imageReference.sku","like":"gen2"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"OpenLogic"},{"field":"properties.storageProfile.imageReference.offer","equals":"CENTOS"},{"field":"properties.storageProfile.imageReference.sku","equals":"8_3-gen2"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"Oracle"},{"field":"properties.storageProfile.imageReference.offer","equals":"Oracle-Linux"},{"field":"properties.storageProfile.imageReference.sku","equals":"ol83-lvm-gen2"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"microsoftcblmariner"},{"field":"properties.storageProfile.imageReference.offer","equals":"cbl-mariner"},{"field":"properties.storageProfile.imageReference.sku","equals":"1-gen2"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"debian"},{"field":"properties.storageProfile.imageReference.offer","equals":"debian-11"},{"field":"properties.storageProfile.imageReference.sku","equals":"11-gen2"}]}]},{"field":"properties.securityProfile.securityType","in":["TrustedLaunch","ConfidentialVM"]},{"field":"properties.securityProfile.uefiSettings","exists":true},{"field":"properties.securityProfile.uefiSettings.secureBootEnabled","equals":"true"},{"field":"properties.securityProfile.uefiSettings.vTpmEnabled","equals":"true"}]},"condition":{"field":"resources","allOf":[{"allOf":[{"field":"properties.publisher","equals":"Microsoft.Azure.Security.LinuxAttestation"},{"field":"properties.type","equals":"GuestAttestation"},{"field":"properties.provisioningState","in":["Succeeded","Provisioning succeeded"]}]}],"where":{"type":".","equals":"Microsoft.Compute/virtualMachines/extensions"}}}},{
// Synopsis: Install Guest Attestation extension on supported Linux virtual machines scale sets to allow Azure Security Center to proactively attest and monitor the boot integrity. Once installed, boot integrity will be attested via Remote Attestation.  This assessment applies to Trusted Launch and Confidential Linux virtual machine scale sets.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.8de2c5eee2ed","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/a21f8c92-9e22-4f09-b759-50500d1d2dda","Azure.Policy/version":"5.0.0-preview"}},"spec":{"type":["Microsoft.Compute/virtualMachineScaleSets"],"where":{"allOf":[{"equals":"Microsoft.Compute/virtualMachineScaleSets","type":"."},{"anyOf":[{"allOf":[{"field":"properties.virtualMachineProfile.storageProfile.imageReference.publisher","equals":"Canonical"},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.offer","equals":"UbuntuServer"},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.sku","like":"18_04-lts-gen2"}]},{"allOf":[{"field":"properties.virtualMachineProfile.storageProfile.imageReference.publisher","equals":"Canonical"},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.offer","equals":"0001-com-ubuntu-server-focal"},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.sku","like":"20_04-lts-gen2"}]},{"allOf":[{"field":"properties.virtualMachineProfile.storageProfile.imageReference.publisher","equals":"Canonical"},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.offer","equals":"0001-com-ubuntu-confidential-vm-focal"},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.sku","like":"20_04-lts-cvm"}]},{"allOf":[{"field":"properties.virtualMachineProfile.storageProfile.imageReference.publisher","equals":"RedHat"},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.offer","equals":"RHEL"},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.sku","like":"83-gen2"}]},{"allOf":[{"field":"properties.virtualMachineProfile.storageProfile.imageReference.publisher","equals":"SUSE"},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.offer","equals":"SLES-15-SP2"},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.sku","like":"gen2"}]},{"allOf":[{"field":"properties.virtualMachineProfile.storageProfile.imageReference.publisher","equals":"OpenLogic"},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.offer","equals":"CENTOS"},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.sku","equals":"8_3-gen2"}]},{"allOf":[{"field":"properties.virtualMachineProfile.storageProfile.imageReference.publisher","equals":"Oracle"},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.offer","equals":"Oracle-Linux"},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.sku","equals":"ol83-lvm-gen2"}]},{"allOf":[{"field":"properties.virtualMachineProfile.storageProfile.imageReference.publisher","equals":"microsoftcblmariner"},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.offer","equals":"cbl-mariner"},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.sku","equals":"1-gen2"}]},{"allOf":[{"field":"properties.virtualMachineProfile.storageProfile.imageReference.publisher","equals":"debian"},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.offer","equals":"debian-11"},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.sku","equals":"11-gen2"}]}]},{"field":"properties.virtualMachineProfile.securityProfile.securityType","in":["TrustedLaunch","ConfidentialVM"]},{"field":"properties.virtualMachineProfile.securityProfile.uefiSettings","exists":true},{"field":"properties.virtualMachineProfile.securityProfile.uefiSettings.vTpmEnabled","equals":"true"},{"field":"properties.virtualMachineProfile.securityProfile.uefiSettings.secureBootEnabled","equals":"true"}]},"condition":{"field":"resources","allOf":[{"allOf":[{"field":"properties.publisher","equals":"Microsoft.Azure.Security.LinuxAttestation"},{"field":"properties.type","equals":"GuestAttestation"},{"field":"properties.provisioningState","in":["Succeeded","Provisioning succeeded"]}]}],"where":{"type":".","equals":"Microsoft.Compute/virtualMachineScaleSets/extensions"}}}},{
// Synopsis: Install Guest Attestation extension on supported virtual machines to allow Azure Security Center to proactively attest and monitor the boot integrity. Once installed, boot integrity will be attested via Remote Attestation. This assessment applies to Trusted Launch and Confidential Windows virtual machines.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.8a49f91c0771","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/1cb4d9c2-f88f-4069-bee0-dba239a57b09","Azure.Policy/version":"4.0.0-preview"}},"spec":{"type":["Microsoft.Compute/virtualMachines"],"where":{"allOf":[{"equals":"Microsoft.Compute/virtualMachines","type":"."},{"anyOf":[{"field":"properties.storageProfile.imageReference.offer","like":"windows*"},{"field":"properties.storageProfile.osDisk.osType","like":"Windows*"}]},{"field":"properties.securityProfile.securityType","in":["TrustedLaunch","ConfidentialVM"]},{"field":"properties.securityProfile.uefiSettings","exists":true},{"field":"properties.securityProfile.uefiSettings.secureBootEnabled","equals":"true"},{"field":"properties.securityProfile.uefiSettings.vTpmEnabled","equals":"true"}]},"condition":{"field":"resources","allOf":[{"allOf":[{"field":"properties.publisher","equals":"Microsoft.Azure.Security.WindowsAttestation"},{"field":"properties.type","equals":"GuestAttestation"},{"field":"properties.provisioningState","in":["Succeeded","Provisioning succeeded"]}]}],"where":{"type":".","equals":"Microsoft.Compute/virtualMachines/extensions"}}}},{
// Synopsis: Install Guest Attestation extension on supported virtual machines scale sets to allow Azure Security Center to proactively attest and monitor the boot integrity. Once installed, boot integrity will be attested via Remote Attestation. This assessment applies to Trusted Launch and Confidential Windows virtual machine scale sets.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.df2730356e48","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/f655e522-adff-494d-95c2-52d4f6d56a42","Azure.Policy/version":"3.0.0-preview"}},"spec":{"type":["Microsoft.Compute/virtualMachineScaleSets"],"where":{"allOf":[{"equals":"Microsoft.Compute/virtualMachineScaleSets","type":"."},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.offer","like":"windows*"},{"field":"properties.virtualMachineProfile.securityProfile.securityType","in":["TrustedLaunch","ConfidentialVM"]},{"field":"properties.virtualMachineProfile.securityProfile.uefiSettings","exists":true},{"field":"properties.virtualMachineProfile.securityProfile.uefiSettings.vTpmEnabled","equals":"true"},{"field":"properties.virtualMachineProfile.securityProfile.uefiSettings.secureBootEnabled","equals":"true"}]},"condition":{"field":"resources","allOf":[{"allOf":[{"field":"properties.publisher","equals":"Microsoft.Azure.Security.WindowsAttestation"},{"field":"properties.type","equals":"GuestAttestation"},{"field":"properties.provisioningState","in":["Succeeded","Provisioning succeeded"]}]}],"where":{"type":".","equals":"Microsoft.Compute/virtualMachineScaleSets/extensions"}}}},{
// Synopsis: Azure Defender for open-source relational databases detects anomalous activities indicating unusual and potentially harmful attempts to access or exploit databases. Learn more about the capabilities of Azure Defender for open-source relational databases at https://aka.ms/AzDforOpenSourceDBsDocu. Important: Enabling this plan will result in charges for protecting your open-source relational databases. Learn about the pricing on Security Center's pricing page: https://aka.ms/pricing-security-center
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.f683f1d3ef51","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/0a9fbe0d-c5c4-4da8-87d8-f4fd77338835","Azure.Policy/version":"1.0.0"}},"spec":{"type":["Microsoft.Resources/subscriptions"],"where":{"equals":"Microsoft.Resources/subscriptions","type":"."},"condition":{"field":"resources","allOf":[{"field":"properties.pricingTier","equals":"Standard"}],"where":{"allOf":[{"type":".","equals":"Microsoft.Security/pricings"},{"name":".","equals":"OpenSourceRelationalDatabases"}]}}}}]